{"version":3,"file":"normalizePhone.js","names":["_","require","ValidationError","normalizePhone","phone","defaultArea","trim","length","leftB","indexOf","rightB","substr","trimStart","substring","replace","s","data","module","exports"],"sources":["../../src/processors/normalizePhone.js"],"sourcesContent":["const { _ } = require('@genx/july');\nconst { ValidationError } = require('../utils/Errors');\n\nfunction normalizePhone(phone, defaultArea) {\n    if (phone) {\n        phone = phone.trim();\n\n        if (phone.length > 0) {\n            const leftB = phone.indexOf('(');\n            const rightB = phone.indexOf(')');\n\n            if (leftB >= 0 && rightB > leftB) {\n                phone =\n                    phone.substr(0, leftB) +\n                    _.trimStart(phone.substring(leftB + 1, rightB), '0') +\n                    phone.substr(rightB + 1);\n            }\n\n            phone = phone.replace(/ |-/g, '');\n\n            const s = phone[0];\n\n            if (s === '+') {\n                // nothing\n            } else if (s === '0') {\n                if (phone[1] === '0') {\n                    phone = '+' + phone.substr(2);\n                } else {\n                    if (defaultArea == null) {\n                        throw new ValidationError(\n                            'The mobile phone number must be supplied with a country code.',\n                            {\n                                data: phone,\n                            }\n                        );\n                    }\n                    phone = defaultArea + phone.substr(1);\n                }\n            } else {\n                if (defaultArea == null) {\n                    throw new ValidationError(\n                        'The mobile phone number must be supplied with a country code.',\n                        {\n                            data: phone,\n                        }\n                    );\n                }\n                phone = defaultArea + phone;\n            }\n        }\n    }\n\n    return phone;\n}\n\nmodule.exports = normalizePhone;\n"],"mappings":";;;;AAAA,MAAM;EAAEA;AAAF,IAAQC,OAAO,CAAC,YAAD,CAArB;;AACA,MAAM;EAAEC;AAAF,IAAsBD,OAAO,CAAC,iBAAD,CAAnC;;AAEA,SAASE,cAAT,CAAwBC,KAAxB,EAA+BC,WAA/B,EAA4C;EACxC,IAAID,KAAJ,EAAW;IACPA,KAAK,GAAGA,KAAK,CAACE,IAAN,EAAR;;IAEA,IAAIF,KAAK,CAACG,MAAN,GAAe,CAAnB,EAAsB;MAClB,MAAMC,KAAK,GAAGJ,KAAK,CAACK,OAAN,CAAc,GAAd,CAAd;MACA,MAAMC,MAAM,GAAGN,KAAK,CAACK,OAAN,CAAc,GAAd,CAAf;;MAEA,IAAID,KAAK,IAAI,CAAT,IAAcE,MAAM,GAAGF,KAA3B,EAAkC;QAC9BJ,KAAK,GACDA,KAAK,CAACO,MAAN,CAAa,CAAb,EAAgBH,KAAhB,IACAR,CAAC,CAACY,SAAF,CAAYR,KAAK,CAACS,SAAN,CAAgBL,KAAK,GAAG,CAAxB,EAA2BE,MAA3B,CAAZ,EAAgD,GAAhD,CADA,GAEAN,KAAK,CAACO,MAAN,CAAaD,MAAM,GAAG,CAAtB,CAHJ;MAIH;;MAEDN,KAAK,GAAGA,KAAK,CAACU,OAAN,CAAc,MAAd,EAAsB,EAAtB,CAAR;MAEA,MAAMC,CAAC,GAAGX,KAAK,CAAC,CAAD,CAAf;;MAEA,IAAIW,CAAC,KAAK,GAAV,EAAe,CAEd,CAFD,MAEO,IAAIA,CAAC,KAAK,GAAV,EAAe;QAClB,IAAIX,KAAK,CAAC,CAAD,CAAL,KAAa,GAAjB,EAAsB;UAClBA,KAAK,GAAG,MAAMA,KAAK,CAACO,MAAN,CAAa,CAAb,CAAd;QACH,CAFD,MAEO;UACH,IAAIN,WAAW,IAAI,IAAnB,EAAyB;YACrB,MAAM,IAAIH,eAAJ,CACF,+DADE,EAEF;cACIc,IAAI,EAAEZ;YADV,CAFE,CAAN;UAMH;;UACDA,KAAK,GAAGC,WAAW,GAAGD,KAAK,CAACO,MAAN,CAAa,CAAb,CAAtB;QACH;MACJ,CAdM,MAcA;QACH,IAAIN,WAAW,IAAI,IAAnB,EAAyB;UACrB,MAAM,IAAIH,eAAJ,CACF,+DADE,EAEF;YACIc,IAAI,EAAEZ;UADV,CAFE,CAAN;QAMH;;QACDA,KAAK,GAAGC,WAAW,GAAGD,KAAtB;MACH;IACJ;EACJ;;EAED,OAAOA,KAAP;AACH;;AAEDa,MAAM,CAACC,OAAP,GAAiBf,cAAjB"}