"use strict";require("source-map-support/register");const path=require("path");const util=require("util");const Util=require("./util.js");const Promise=Util.Promise;const Convertors=require("./Convertors");class I18n{constructor(config){config||(config={});this.supportedLocales=config.supportedLocales?config.supportedLocales.map(l=>I18n.normalizeLocale(l)):["en_AU","en_US","zh_CN"];this.reverseUpdate=util.isNullOrUndefined(config.reverseUpdate)?false:Convertors.toBoolean(config.reverseUpdate);this.updateWithMeta=util.isNullOrUndefined(config.updateWithMeta)?false:Convertors.toBoolean(config.updateWithMeta);this.timezone=config.timezone;this.pendingUpdates={}}isLocaleSupported(locale){let n=locale&&I18n.normalizeLocale(locale);return this.supportedLocales.some(l=>n===l)}async setupAsync(locale){if(!this.isLocaleSupported(locale))return Promise.reject("unsupported_locale");this.dictionary={};this.locale=I18n.normalizeLocale(locale||this.supportedLocales[0]);this.momentLocale=I18n.localeToDash(this.locale).toLowerCase();this.momentTimezone=Util.timezone;return this}getText(token,values,defaultText){if(Util._.isString(values)){defaultText=values;values=null}var phrase=Util.getValueByPath(this.dictionary,token);if(util.isNullOrUndefined(phrase)){phrase=defaultText;if(phrase){if(this.reverseUpdate)this.addToDictionary(token,phrase)}else{phrase=token}}else if(util.isObject(phrase)){phrase=phrase["text"]}return Util._.isEmpty(values)?phrase:Util.template(phrase,values)}addToDictionary(token,text,saveImmediate){if(this.updateWithMeta){text={text:text,comment:"Added at "+this.datetime().format()}}Util.setValueByPath(this.dictionary,token,text);this.pendingUpdates[token]=text;if(saveImmediate){this.save()}}save(){this.pendingUpdates={}}datetime(value,timezone){timezone||(timezone=this.timezone);var r=this.momentTimezone(value).locale(this.momentLocale);return timezone?r.tz(timezone):r}flush(){if(this.reverseUpdate){this.save()}}get dashForm(){return I18n.localeToDash(this.locale)}static normalizeLocale(locale){var l=locale.replace("-","_").split("_",2);var l2=l[0].toLowerCase();if(l.length>1){l2+="_"+l[1].toUpperCase()}return l2}static localeToDash(locale){return locale.replace("_","-")}static extractLanguageCode(locale){var pos=locale.lastIndexOf("_");if(pos==-1)return locale;return locale.substr(0,pos)}static extractCountryCode(locale){var pos=locale.lastIndexOf("_");if(pos==-1)return"";return locale.substr(pos+1)}}class FileI18n extends I18n{constructor(config){super(config);config||(config={});this.directory=config.directory||"./locale"}async setupAsync(locale){const self=this;function loadDir(dict,dir,finish){Util.fs.readdir(dir,function(err,files){if(err)return finish(err);Util.async.each(files,function(file,cb){let langFilePath=path.join(dir,file);let stats=Util.fs.statSync(langFilePath);if(stats.isDirectory()){dict[file]={};return loadDir(dict[file],langFilePath,cb)}let extName=path.extname(file);if(extName.toLowerCase()!==".json")return cb();Util.fs.readJson(langFilePath,function(err,content){if(err)return cb(err);let basename=path.basename(file,extName);dict[basename]=content;cb()})},finish)})}return super.setupAsync(locale).then(()=>{let langPath=path.resolve(self.directory,"lang");return new Promise((resolve,reject)=>{let p=path.join(langPath,self.locale);if(!Util.fs.existsSync(p)){let lang=I18n.extractLanguageCode(self.locale);p=path.join(langPath,lang);if(!Util.fs.existsSync(p)){return resolve(self)}}loadDir(self.dictionary,p,err=>{if(err)return reject(err);resolve(self)})})})}save(){var fileSet=new Set;Util._.forOwn(this.pendingUpdates,(v,k)=>{let keyword=path.extname(k);let p=path.basename(k,keyword);fileSet.add(p)});var langPath=path.resolve(this.directory,"lang");var bp=path.join(langPath,this.locale);for(let p of fileSet){let content=Util.getValueByPath(this.dictionary,p);let f=Util.replaceAll(p,".",path.delimiter)+".json";Util.fs.outputJsonSync(path.join(bp,f),content)}fileSet.clear();super.save()}}I18n.File=FileI18n;module.exports=I18n;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pMThuLmpzIl0sIm5hbWVzIjpbInBhdGgiLCJyZXF1aXJlIiwidXRpbCIsIlV0aWwiLCJQcm9taXNlIiwiQ29udmVydG9ycyIsIkkxOG4iLCJjb25zdHJ1Y3RvciIsImNvbmZpZyIsInN1cHBvcnRlZExvY2FsZXMiLCJtYXAiLCJsIiwibm9ybWFsaXplTG9jYWxlIiwicmV2ZXJzZVVwZGF0ZSIsImlzTnVsbE9yVW5kZWZpbmVkIiwidG9Cb29sZWFuIiwidXBkYXRlV2l0aE1ldGEiLCJ0aW1lem9uZSIsInBlbmRpbmdVcGRhdGVzIiwiaXNMb2NhbGVTdXBwb3J0ZWQiLCJsb2NhbGUiLCJuIiwic29tZSIsInNldHVwQXN5bmMiLCJyZWplY3QiLCJkaWN0aW9uYXJ5IiwibW9tZW50TG9jYWxlIiwibG9jYWxlVG9EYXNoIiwidG9Mb3dlckNhc2UiLCJtb21lbnRUaW1lem9uZSIsImdldFRleHQiLCJ0b2tlbiIsInZhbHVlcyIsImRlZmF1bHRUZXh0IiwiXyIsImlzU3RyaW5nIiwicGhyYXNlIiwiZ2V0VmFsdWVCeVBhdGgiLCJhZGRUb0RpY3Rpb25hcnkiLCJpc09iamVjdCIsImlzRW1wdHkiLCJ0ZW1wbGF0ZSIsInRleHQiLCJzYXZlSW1tZWRpYXRlIiwiY29tbWVudCIsImRhdGV0aW1lIiwiZm9ybWF0Iiwic2V0VmFsdWVCeVBhdGgiLCJzYXZlIiwidmFsdWUiLCJyIiwidHoiLCJmbHVzaCIsImRhc2hGb3JtIiwicmVwbGFjZSIsInNwbGl0IiwibDIiLCJsZW5ndGgiLCJ0b1VwcGVyQ2FzZSIsImV4dHJhY3RMYW5ndWFnZUNvZGUiLCJwb3MiLCJsYXN0SW5kZXhPZiIsInN1YnN0ciIsImV4dHJhY3RDb3VudHJ5Q29kZSIsIkZpbGVJMThuIiwiZGlyZWN0b3J5Iiwic2VsZiIsImxvYWREaXIiLCJkaWN0IiwiZGlyIiwiZmluaXNoIiwiZnMiLCJyZWFkZGlyIiwiZXJyIiwiZmlsZXMiLCJhc3luYyIsImVhY2giLCJmaWxlIiwiY2IiLCJsYW5nRmlsZVBhdGgiLCJqb2luIiwic3RhdHMiLCJzdGF0U3luYyIsImlzRGlyZWN0b3J5IiwiZXh0TmFtZSIsImV4dG5hbWUiLCJyZWFkSnNvbiIsImNvbnRlbnQiLCJiYXNlbmFtZSIsInRoZW4iLCJsYW5nUGF0aCIsInJlc29sdmUiLCJwIiwiZXhpc3RzU3luYyIsImxhbmciLCJmaWxlU2V0IiwiU2V0IiwiZm9yT3duIiwidiIsImsiLCJrZXl3b3JkIiwiYWRkIiwiYnAiLCJmIiwicmVwbGFjZUFsbCIsImRlbGltaXRlciIsIm91dHB1dEpzb25TeW5jIiwiY2xlYXIiLCJGaWxlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUEsYSx1Q0FFQSxLQUFNQSxDQUFBQSxJQUFJLENBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCLENBQ0EsS0FBTUMsQ0FBQUEsSUFBSSxDQUFHRCxPQUFPLENBQUMsTUFBRCxDQUFwQixDQUNBLEtBQU1FLENBQUFBLElBQUksQ0FBR0YsT0FBTyxDQUFDLFdBQUQsQ0FBcEIsQ0FDQSxLQUFNRyxDQUFBQSxPQUFPLENBQUdELElBQUksQ0FBQ0MsT0FBckIsQ0FDQSxLQUFNQyxDQUFBQSxVQUFVLENBQUdKLE9BQU8sQ0FBQyxjQUFELENBQTFCLENBRUEsS0FBTUssQ0FBQUEsSUFBSyxDQVVQQyxXQUFXLENBQUNDLE1BQUQsQ0FBUyxDQUNoQkEsTUFBTSxHQUFLQSxNQUFNLENBQUcsRUFBZCxDQUFOLENBRUEsS0FBS0MsZ0JBQUwsQ0FBd0JELE1BQU0sQ0FBQ0MsZ0JBQVAsQ0FBMEJELE1BQU0sQ0FBQ0MsZ0JBQVAsQ0FBd0JDLEdBQXhCLENBQTRCQyxDQUFDLEVBQUlMLElBQUksQ0FBQ00sZUFBTCxDQUFxQkQsQ0FBckIsQ0FBakMsQ0FBMUIsQ0FBc0YsQ0FBRSxPQUFGLENBQVcsT0FBWCxDQUFvQixPQUFwQixDQUE5RyxDQUNBLEtBQUtFLGFBQUwsQ0FBcUJYLElBQUksQ0FBQ1ksaUJBQUwsQ0FBdUJOLE1BQU0sQ0FBQ0ssYUFBOUIsRUFBK0MsS0FBL0MsQ0FBd0RSLFVB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YXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcbmNvbnN0IFV0aWwgPSByZXF1aXJlKCcuL3V0aWwuanMnKTtcbmNvbnN0IFByb21pc2UgPSBVdGlsLlByb21pc2U7XG5jb25zdCBDb252ZXJ0b3JzID0gcmVxdWlyZSgnLi9Db252ZXJ0b3JzJyk7XG5cbmNsYXNzIEkxOG4ge1xuICAgIC8qKlxuICAgICAqIEFuIGFwcCBtb2R1bGUgb2JqZWN0LlxuICAgICAqIEBjb25zdHJ1Y3RzIEkxOG5cbiAgICAgKiBAcGFyYW0ge29iamVjdH0gW2NvbmZpZ10gLSBUaGUgaTE4biBjb25maWd1cmF0aW9uLlxuICAgICAqIEBwcm9wZXJ0eSB7YXJyYXl9IFtjb25maWcuc3VwcG9ydGVkTG9jYWxlc10gLSBUaGUgZGVmYXVsdCBsb2NhbGVcbiAgICAgKiBAcHJvcGVydHkge2Jvb2x9IFtjb25maWcucmV2ZXJzZVVwZGF0ZT1mYWxzZV0gLSBSZXZlcnNlIHVwZGF0ZSB3aGVuXG4gICAgICogQHByb3BlcnR5IHtib29sfSBbY29uZmlnLnVwZGF0ZVdpdGhNZXRhPWZhbHNlXSAtXG4gICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtjb25maWcudGltZXpvbmVdIC0gVGltZXpvbmVcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihjb25maWcpIHtcbiAgICAgICAgY29uZmlnIHx8IChjb25maWcgPSB7fSk7XG5cbiAgICAgICAgdGhpcy5zdXBwb3J0ZWRMb2NhbGVzID0gY29uZmlnLnN1cHBvcnRlZExvY2FsZXMgPyBjb25maWcuc3VwcG9ydGVkTG9jYWxlcy5tYXAobCA9PiBJMThuLm5vcm1hbGl6ZUxvY2FsZShsKSkgOiBbICdlbl9BVScsICdlbl9VUycsICd6aF9DTicgXTtcbiAgICAgICAgdGhpcy5yZXZlcnNlVXBkYXRlID0gdXRpbC5pc051bGxPclVuZGVmaW5lZChjb25maWcucmV2ZXJzZVVwZGF0ZSkgPyBmYWxzZSA6ICBDb252ZXJ0b3JzLnRvQm9vbGVhbihjb25maWcucmV2ZXJzZVVwZGF0ZSk7XG4gICAgICAgIHRoaXMudXBkYXRlV2l0aE1ldGEgPSB1dGlsLmlzTnVsbE9yVW5kZWZpbmVkKGNvbmZpZy51cGRhdGVXaXRoTWV0YSkgPyBmYWxzZSA6IENvbnZlcnRvcnMudG9Cb29sZWFuKGNvbmZpZy51cGRhdGVXaXRoTWV0YSk7XG4gICAgICAgIHRoaXMudGltZXpvbmUgPSBjb25maWcudGltZXpvbmU7XG4gICAgICAgIHRoaXMucGVuZGluZ1VwZGF0ZXMgPSB7fTtcbiAgICB9XG5cbiAgICBpc0xvY2FsZVN1cHBvcnRlZChsb2NhbGUpIHtcbiAgICAgICAgbGV0IG4gPSBsb2NhbGUgJiYgSTE4bi5ub3JtYWxpemVMb2NhbGUobG9jYWxlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3VwcG9ydGVkTG9jYWxlcy5zb21lKGwgPT4gbiA9PT0gbCk7XG4gICAgfVxuXG4gICAgYXN5bmMgc2V0dXBBc3luYyhsb2NhbGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzTG9jYWxlU3VwcG9ydGVkKGxvY2FsZSkpIHJldHVybiBQcm9taXNlLnJlamVjdCgndW5zdXBwb3J0ZWRfbG9jYWxlJyk7XG5cbiAgICAgICAgdGhpcy5kaWN0aW9uYXJ5ID0ge307XG5cbiAgICAgICAgdGhpcy5sb2NhbGUgPSBJMThuLm5vcm1hbGl6ZUxvY2FsZShsb2NhbGUgfHwgdGhpcy5zdXBwb3J0ZWRMb2NhbGVzWzBdKTtcbiAgICAgICAgdGhpcy5tb21lbnRMb2NhbGUgPSBJMThuLmxvY2FsZVRvRGFzaCh0aGlzLmxvY2FsZSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgdGhpcy5tb21lbnRUaW1lem9uZSA9IFV0aWwudGltZXpvbmU7XG5cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuXG4gICAgZ2V0VGV4dCh0b2tlbiwgdmFsdWVzLCBkZWZhdWx0VGV4dCkge1xuICAgICAgICBpZiAoVXRpbC5fLmlzU3RyaW5nKHZhbHVlcykpIHtcbiAgICAgICAgICAgIGRlZmF1bHRUZXh0ID0gdmFsdWVzO1xuICAgICAgICAgICAgdmFsdWVzID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwaHJhc2UgPSBVdGlsLmdldFZhbHVlQnlQYXRoKHRoaXMuZGljdGlvbmFyeSwgdG9rZW4pO1xuXG4gICAgICAgIGlmICh1dGlsLmlzTnVsbE9yVW5kZWZpbmVkKHBocmFzZSkpIHtcbiAgICAgICAgICAgIHBocmFzZSA9IGRlZmF1bHRUZXh0O1xuXG4gICAgICAgICAgICBpZiAocGhyYXNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmV2ZXJzZVVwZGF0ZSkgdGhpcy5hZGRUb0RpY3Rpb25hcnkodG9rZW4sIHBocmFzZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHBocmFzZSA9IHRva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHV0aWwuaXNPYmplY3QocGhyYXNlKSkge1xuICAgICAgICAgICAgcGhyYXNlID0gcGhyYXNlWyd0ZXh0J107XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gVXRpbC5fLmlzRW1wdHkodmFsdWVzKSA/IHBocmFzZSA6IFV0aWwudGVtcGxhdGUocGhyYXNlLCB2YWx1ZXMpO1xuICAgIH1cblxuICAgIGFkZFRvRGljdGlvbmFyeSh0b2tlbiwgdGV4dCwgc2F2ZUltbWVkaWF0ZSkge1xuICAgICAgICBpZiAodGhpcy51cGRhdGVXaXRoTWV0YSkge1xuICAgICAgICAgICAgdGV4dCA9IHsgdGV4dDogdGV4dCwgY29tbWVudDogJ0FkZGVkIGF0ICcgKyB0aGlzLmRhdGV0aW1lKCkuZm9ybWF0KCkgfVxuICAgICAgICB9XG5cbiAgICAgICAgVXRpbC5zZXRWYWx1ZUJ5UGF0aCh0aGlzLmRpY3Rpb25hcnksIHRva2VuLCB0ZXh0KTtcblxuICAgICAgICB0aGlzLnBlbmRpbmdVcGRhdGVzW3Rva2VuXSA9IHRleHQ7XG5cbiAgICAgICAgaWYgKHNhdmVJbW1lZGlhdGUpIHtcbiAgICAgICAgICAgIHRoaXMuc2F2ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2F2ZSgpIHtcbiAgICAgICAgdGhpcy5wZW5kaW5nVXBkYXRlcyA9IHt9O1xuICAgIH1cblxuICAgIGRhdGV0aW1lKHZhbHVlLCB0aW1lem9uZSkge1xuICAgICAgICB0aW1lem9uZSB8fCAodGltZXpvbmUgPSB0aGlzLnRpbWV6b25lKTtcblxuICAgICAgICB2YXIgciA9IHRoaXMubW9tZW50VGltZXpvbmUodmFsdWUpLmxvY2FsZSh0aGlzLm1vbWVudExvY2FsZSk7XG5cbiAgICAgICAgcmV0dXJuIHRpbWV6b25lID8gci50eih0aW1lem9uZSkgOiByO1xuICAgIH1cblxuICAgIGZsdXNoKCkge1xuICAgICAgICBpZiAodGhpcy5yZXZlcnNlVXBkYXRlKSB7IHRoaXMuc2F2ZSgpOyB9XG4gICAgfVxuXG4gICAgZ2V0IGRhc2hGb3JtKCkge1xuICAgICAgICByZXR1cm4gSTE4bi5sb2NhbGVUb0Rhc2godGhpcy5sb2NhbGUpO1xuICAgIH1cblxuICAgIHN0YXRpYyBub3JtYWxpemVMb2NhbGUobG9jYWxlKSB7XG4gICAgICAgIHZhciBsID0gbG9jYWxlLnJlcGxhY2UoJy0nLCAnXycpLnNwbGl0KCdfJywgMik7XG4gICAgICAgIHZhciBsMiA9IGxbMF0udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKGwubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgbDIgKz0gJ18nICsgbFsxXS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsMjtcbiAgICB9XG5cbiAgICBzdGF0aWMgbG9jYWxlVG9EYXNoKGxvY2FsZSkge1xuICAgICAgICByZXR1cm4gbG9jYWxlLnJlcGxhY2UoJ18nLCAnLScpO1xuICAgIH1cblxuICAgIHN0YXRpYyBleHRyYWN0TGFuZ3VhZ2VDb2RlKGxvY2FsZSkge1xuICAgICAgICB2YXIgcG9zID0gbG9jYWxlLmxhc3RJbmRleE9mKCdfJyk7XG4gICAgICAgIGlmIChwb3MgPT0gLTEpIHJldHVybiBsb2NhbGU7XG5cbiAgICAgICAgcmV0dXJuIGxvY2FsZS5zdWJzdHIoMCwgcG9zKTtcbiAgICB9XG5cbiAgICBzdGF0aWMgZXh0cmFjdENvdW50cnlDb2RlKGxvY2FsZSkge1xuICAgICAgICB2YXIgcG9zID0gbG9jYWxlLmxhc3RJbmRleE9mKCdfJyk7XG4gICAgICAgIGlmIChwb3MgPT0gLTEpIHJldHVybiAnJztcblxuICAgICAgICByZXR1cm4gbG9jYWxlLnN1YnN0cihwb3MgKyAxKTtcbiAgICB9ICAgIFxufVxuXG5jbGFzcyBGaWxlSTE4biBleHRlbmRzIEkxOG4ge1xuXG4gICAgY29uc3RydWN0b3IoY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKGNvbmZpZyk7XG5cbiAgICAgICAgY29uZmlnIHx8IChjb25maWcgPSB7fSk7XG5cbiAgICAgICAgdGhpcy5kaXJlY3RvcnkgPSBjb25maWcuZGlyZWN0b3J5IHx8ICcuL2xvY2FsZSc7XG4gICAgfVxuXG4gICAgYXN5bmMgc2V0dXBBc3luYyhsb2NhbGUpIHtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgZnVuY3Rpb24gbG9hZERpcihkaWN0LCBkaXIsIGZpbmlzaCkge1xuICAgICAgICAgICAgVXRpbC5mcy5yZWFkZGlyKGRpciwgZnVuY3Rpb24gKGVyciwgZmlsZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gZmluaXNoKGVycik7XG5cbiAgICAgICAgICAgICAgICBVdGlsLmFzeW5jLmVhY2goZmlsZXMsIGZ1bmN0aW9uIChmaWxlLCBjYikge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbGFuZ0ZpbGVQYXRoID0gcGF0aC5qb2luKGRpciwgZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzdGF0cyA9IFV0aWwuZnMuc3RhdFN5bmMobGFuZ0ZpbGVQYXRoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHMuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGljdFtmaWxlXSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvYWREaXIoZGljdFtmaWxlXSwgbGFuZ0ZpbGVQYXRoLCBjYik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBsZXQgZXh0TmFtZSA9IHBhdGguZXh0bmFtZShmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4dE5hbWUudG9Mb3dlckNhc2UoKSAhPT0gJy5qc29uJykgcmV0dXJuIGNiKCk7XG5cbiAgICAgICAgICAgICAgICAgICAgVXRpbC5mcy5yZWFkSnNvbihsYW5nRmlsZVBhdGgsIGZ1bmN0aW9uIChlcnIsIGNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHJldHVybiBjYihlcnIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgYmFzZW5hbWUgPSBwYXRoLmJhc2VuYW1lKGZpbGUsIGV4dE5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGljdFtiYXNlbmFtZV0gPSBjb250ZW50O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYigpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0sIGZpbmlzaCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzdXBlci5zZXR1cEFzeW5jKGxvY2FsZSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBsZXQgbGFuZ1BhdGggPSBwYXRoLnJlc29sdmUoc2VsZi5kaXJlY3RvcnksICdsYW5nJyk7XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHAgPSBwYXRoLmpvaW4obGFuZ1BhdGgsIHNlbGYubG9jYWxlKTtcblxuICAgICAgICAgICAgICAgIGlmICghVXRpbC5mcy5leGlzdHNTeW5jKHApKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vdHJ5IG9ubHkgbGFuZ3VhZ2UgY29kZVxuICAgICAgICAgICAgICAgICAgICBsZXQgbGFuZyA9IEkxOG4uZXh0cmFjdExhbmd1YWdlQ29kZShzZWxmLmxvY2FsZSk7XG4gICAgICAgICAgICAgICAgICAgIHAgPSBwYXRoLmpvaW4obGFuZ1BhdGgsIGxhbmcpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghVXRpbC5mcy5leGlzdHNTeW5jKHApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZShzZWxmKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGxvYWREaXIoc2VsZi5kaWN0aW9uYXJ5LCBwLCAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzZWxmKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBzYXZlKCkge1xuICAgICAgICB2YXIgZmlsZVNldCA9IG5ldyBTZXQoKTtcblxuICAgICAgICBVdGlsLl8uZm9yT3duKHRoaXMucGVuZGluZ1VwZGF0ZXMsICh2LCBrKSA9PiB7XG4gICAgICAgICAgICBsZXQga2V5d29yZCA9IHBhdGguZXh0bmFtZShrKTtcbiAgICAgICAgICAgIGxldCBwID0gcGF0aC5iYXNlbmFtZShrLCBrZXl3b3JkKTtcbiAgICAgICAgICAgIGZpbGVTZXQuYWRkKHApO1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgbGFuZ1BhdGggPSBwYXRoLnJlc29sdmUodGhpcy5kaXJlY3RvcnksICdsYW5nJyk7XG4gICAgICAgIHZhciBicCA9IHBhdGguam9pbihsYW5nUGF0aCwgdGhpcy5sb2NhbGUpO1xuXG4gICAgICAgIGZvciAobGV0IHAgb2YgZmlsZVNldCkge1xuICAgICAgICAgICAgbGV0IGNvbnRlbnQgPSBVdGlsLmdldFZhbHVlQnlQYXRoKHRoaXMuZGljdGlvbmFyeSwgcCk7XG4gICAgICAgICAgICBsZXQgZiA9IFV0aWwucmVwbGFjZUFsbChwLCAnLicsIHBhdGguZGVsaW1pdGVyKSArICcuanNvbic7XG5cbiAgICAgICAgICAgIFV0aWwuZnMub3V0cHV0SnNvblN5bmMocGF0aC5qb2luKGJwLCBmKSwgY29udGVudCk7XG4gICAgICAgIH1cblxuICAgICAgICBmaWxlU2V0LmNsZWFyKCk7XG5cbiAgICAgICAgc3VwZXIuc2F2ZSgpO1xuICAgIH1cbn1cblxuSTE4bi5GaWxlID0gRmlsZUkxOG47XG5cbm1vZHVsZS5leHBvcnRzID0gSTE4bjsiXX0=