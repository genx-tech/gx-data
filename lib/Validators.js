"use strict";

require("source-map-support/register");

const Util = require('rk-utils');

const {
  _
} = Util;

const {
  isNothing
} = require('./utils/lang');

const {
  tryRequire
} = require('./utils/lib');

const {
  ValidationError
} = require('./utils/Errors');

const validator = require('validator');

module.exports = _.pick(validator, ['equals', 'contains', 'matches', 'isEmail', 'isURL', 'isMACAddress', 'isIP', 'isFQDN', 'isBoolean', 'isAlpha', 'isAlphanumeric', 'isNumeric', 'isPort', 'isLowercase', 'isUppercase', 'isAscii', 'isFullWidth', 'isHalfWidth', 'isVariableWidth', 'isMultibyte', 'isSurrogatePair', 'isInt', 'isFloat', 'isDecimal', 'isHexadecimal', 'isDivisibleBy', 'isHexColor', 'isISRC', 'isMD5', 'isHash', 'isJSON', 'isEmpty', 'isLength', 'isByteLength', 'isUUID', 'isMongoId', 'isAfter', 'isBefore', 'isIn', 'isCreditCard', 'isISIN', 'isISBN', 'isISSN', 'isMobilePhone', 'isPostalCode', 'isCurrency', 'isISO8601', 'isISO31661Alpha2', 'isBase64', 'isDataURI', 'isMimeType', 'isLatLong']);
const RE_PHONE = /^((\+|00)\d+)?(\(\d+\))?((\ |-)?\d+)*$/;

module.exports.isPhone = function (value) {
  return RE_PHONE.test(value);
};

module.exports.min = function (value, minValue) {
  return value >= minValue;
};

module.exports.max = function (value, maxValue) {
  return value <= maxValue;
};

module.exports.gt = function (value, minValue) {
  return value > minValue;
};

module.exports.lt = function (value, maxValue) {
  return value < maxValue;
};

module.exports.maxLength = function (value, maxLength) {
  return value.length <= maxLength;
};

module.exports.notNull = function (value) {
  return !isNothing(value);
};

module.exports.notNullIf = function (value, condition) {
  return !condition || !isNothing(value);
};

function validate(obj, condition) {
  const {
    Query
  } = tryRequire('mingo');
  let query = new Query(condition);
  return query.test(obj);
}

module.exports.validate = validate;

function validateObjectBySchema(raw, schema, i18n, prefix) {
  let latest = {};

  const Types = require('./types');

  _.forOwn(schema, (fieldInfo, fieldName) => {
    var _fieldInfo$default2;

    if (fieldName in raw) {
      let value = raw[fieldName];

      if (isNothing(value)) {
        var _fieldInfo$default;

        if (!fieldInfo.optional) {
          throw new ValidationError(`Value of property "${prefix ? prefix + '.' : ''}${fieldName}" cannot be null`);
        }

        latest[fieldName] = (_fieldInfo$default = fieldInfo.default) !== null && _fieldInfo$default !== void 0 ? _fieldInfo$default : null;
      } else {
        if (fieldInfo.type) {
          latest[fieldName] = Types.sanitize(value, fieldInfo, i18n, (prefix ? prefix + '.' : '') + fieldName);
        } else {
          latest[fieldName] = value;
        }
      }

      return;
    }

    if (!fieldInfo.optional) {
      throw new ValidationError(`Missing required property "${prefix ? prefix + '.' : ''}${fieldName}"`);
    }

    latest[fieldName] = (_fieldInfo$default2 = fieldInfo.default) !== null && _fieldInfo$default2 !== void 0 ? _fieldInfo$default2 : null;
  });

  return latest;
}

module.exports.validateObjectBySchema = validateObjectBySchema;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9WYWxpZGF0b3JzLmpzIl0sIm5hbWVzIjpbIlV0aWwiLCJyZXF1aXJlIiwiXyIsImlzTm90aGluZyIsInRyeVJlcXVpcmUiLCJWYWxpZGF0aW9uRXJyb3IiLCJ2YWxpZGF0b3IiLCJtb2R1bGUiLCJleHBvcnRzIiwicGljayIsIlJFX1BIT05FIiwiaXNQaG9uZSIsInZhbHVlIiwidGVzdCIsIm1pbiIsIm1pblZhbHVlIiwibWF4IiwibWF4VmFsdWUiLCJndCIsImx0IiwibWF4TGVuZ3RoIiwibGVuZ3RoIiwibm90TnVsbCIsIm5vdE51bGxJZiIsImNvbmRpdGlvbiIsInZhbGlkYXRlIiwib2JqIiwiUXVlcnkiLCJxdWVyeSIsInZhbGlkYXRlT2JqZWN0QnlTY2hlbWEiLCJyYXciLCJzY2hlbWEiLCJpMThuIiwicHJlZml4IiwibGF0ZXN0IiwiVHlwZXMiLCJmb3JPd24iLCJmaWVsZEluZm8iLCJmaWVsZE5hbWUiLCJvcHRpb25hbCIsImRlZmF1bHQiLCJ0eXBlIiwic2FuaXRpemUiXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FBRUEsTUFBTUEsSUFBSSxHQUFHQyxPQUFPLENBQUMsVUFBRCxDQUFwQjs7QUFDQSxNQUFNO0FBQUVDLEVBQUFBO0FBQUYsSUFBUUYsSUFBZDs7QUFDQSxNQUFNO0FBQUVHLEVBQUFBO0FBQUYsSUFBZ0JGLE9BQU8sQ0FBQyxjQUFELENBQTdCOztBQUNBLE1BQU07QUFBRUcsRUFBQUE7QUFBRixJQUFpQkgsT0FBTyxDQUFDLGFBQUQsQ0FBOUI7O0FBQ0EsTUFBTTtBQUFFSSxFQUFBQTtBQUFGLElBQXNCSixPQUFPLENBQUMsZ0JBQUQsQ0FBbkM7O0FBQ0EsTUFBTUssU0FBUyxHQUFHTCxPQUFPLENBQUMsV0FBRCxDQUF6Qjs7QUFFQU0sTUFBTSxDQUFDQyxPQUFQLEdBQWlCTixDQUFDLENBQUNPLElBQUYsQ0FBT0gsU0FBUCxFQUFrQixDQUMvQixRQUQrQixFQUUvQixVQUYrQixFQUcvQixTQUgrQixFQUkvQixTQUorQixF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QUFDSDtBQUNKOztBQUVEO0FBQ0g7O0FBRUQsUUFBSSxDQUFDeUIsU0FBUyxDQUFDRSxRQUFmLEVBQXlCO0FBQ3JCLFlBQU0sSUFBSWxDLGVBQUosQ0FBcUIsOEJBQTZCNEIsTUFBTSxHQUFHQSxNQUFNLEdBQUcsR0FBWixHQUFrQixFQUFHLEdBQUVLLFNBQVUsR0FBekYsQ0FBTjtBQUNIOztBQUVESixJQUFBQSxNQUFNLENBQUNJLFNBQUQsQ0FBTiwwQkFBb0JELFNBQVMsQ0FBQ0csT0FBOUIscUVBQXlDLElBQXpDO0FBQ0gsR0EzQkQ7O0FBNkJBLFNBQU9OLE1BQVA7QUFDSDs7QUFFRDNCLE1BQU0sQ0FBQ0MsT0FBUCxDQUFlcUIsc0JBQWYsR0FBd0NBLHNCQUF4QyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5jb25zdCBVdGlsID0gcmVxdWlyZSgncmstdXRpbHMnKTtcbmNvbnN0IHsgXyB9ID0gVXRpbDtcbmNvbnN0IHsgaXNOb3RoaW5nIH0gPSByZXF1aXJlKCcuL3V0aWxzL2xhbmcnKTtcbmNvbnN0IHsgdHJ5UmVxdWlyZSB9ID0gcmVxdWlyZSgnLi91dGlscy9saWInKTtcbmNvbnN0IHsgVmFsaWRhdGlvbkVycm9yIH0gPSByZXF1aXJlKCcuL3V0aWxzL0Vycm9ycycpO1xuY29uc3QgdmFsaWRhdG9yID0gcmVxdWlyZSgndmFsaWRhdG9yJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gXy5waWNrKHZhbGlkYXRvciwgWyBcbiAgICAnZXF1YWxzJyxcbiAgICAnY29udGFpbnMnLFxuICAgICdtYXRjaGVzJyxcbiAgICAnaXNFbWFpbCcsXG4gICAgJ2lzVVJMJyxcbiAgICAnaXNNQUNBZGRyZXNzJyxcbiAgICAnaXNJUCcsXG4gICAgJ2lzRlFETicsXG4gICAgJ2lzQm9vbGVhbicsXG4gICAgJ2lzQWxwaGEnLFxuICAgICdpc0FscGhhbnVtZXJpYycsXG4gICAgJ2lzTnVtZXJpYycsXG4gICAgJ2lzUG9ydCcsXG4gICAgJ2lzTG93ZXJjYXNlJyxcbiAgICAnaXNVcHBlcmNhc2UnLFxuICAgICdpc0FzY2lpJyxcbiAgICAnaXNGdWxsV2lkdGgnLFxuICAgICdpc0hhbGZXaWR0aCcsXG4gICAgJ2lzVmFyaWFibGVXaWR0aCcsXG4gICAgJ2lzTXVsdGlieXRlJyxcbiAgICAnaXNTdXJyb2dhdGVQYWlyJyxcbiAgICAnaXNJbnQnLFxuICAgICdpc0Zsb2F0JyxcbiAgICAnaXNEZWNpbWFsJyxcbiAgICAnaXNIZXhhZGVjaW1hbCcsXG4gICAgJ2lzRGl2aXNpYmxlQnknLFxuICAgICdpc0hleENvbG9yJyxcbiAgICAnaXNJU1JDJyxcbiAgICAnaXNNRDUnLFxuICAgICdpc0hhc2gnLFxuICAgICdpc0pTT04nLFxuICAgICdpc0VtcHR5JyxcbiAgICAnaXNMZW5ndGgnLFxuICAgICdpc0J5dGVMZW5ndGgnLFxuICAgICdpc1VVSUQnLFxuICAgICdpc01vbmdvSWQnLFxuICAgICdpc0FmdGVyJyxcbiAgICAnaXNCZWZvcmUnLFxuICAgICdpc0luJyxcbiAgICAnaXNDcmVkaXRDYXJkJyxcbiAgICAnaXNJU0lOJyxcbiAgICAnaXNJU0JOJyxcbiAgICAnaXNJU1NOJyxcbiAgICAnaXNNb2JpbGVQaG9uZScsXG4gICAgJ2lzUG9zdGFsQ29kZScsXG4gICAgJ2lzQ3VycmVuY3knLFxuICAgICdpc0lTTzg2MDEnLFxuICAgICdpc0lTTzMxNjYxQWxwaGEyJyxcbiAgICAnaXNCYXNlNjQnLFxuICAgICdpc0RhdGFVUkknLFxuICAgICdpc01pbWVUeXBlJyxcbiAgICAnaXNMYXRMb25nJ1xuXSk7XG5cbmNvbnN0IFJFX1BIT05FID0gL14oKFxcK3wwMClcXGQrKT8oXFwoXFxkK1xcKSk/KChcXCB8LSk/XFxkKykqJC87XG5cbm1vZHVsZS5leHBvcnRzLmlzUGhvbmUgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4gUkVfUEhPTkUudGVzdCh2YWx1ZSk7XG59XG5cbm1vZHVsZS5leHBvcnRzLm1pbiA9IGZ1bmN0aW9uICh2YWx1ZSwgbWluVmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgPj0gbWluVmFsdWU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cy5tYXggPSBmdW5jdGlvbiAodmFsdWUsIG1heFZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlIDw9IG1heFZhbHVlO1xufTtcblxubW9kdWxlLmV4cG9ydHMuZ3QgPSBmdW5jdGlvbiAodmFsdWUsIG1pblZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlID4gbWluVmFsdWU7XG59O1xuXG5tb2R1bGUuZXhwb3J0cy5sdCA9IGZ1bmN0aW9uICh2YWx1ZSwgbWF4VmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgPCBtYXhWYWx1ZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzLm1heExlbmd0aCA9IGZ1bmN0aW9uICh2YWx1ZSwgbWF4TGVuZ3RoKSB7XG4gICAgcmV0dXJuIHZhbHVlLmxlbmd0aCA8PSBtYXhMZW5ndGg7XG59O1xuXG5tb2R1bGUuZXhwb3J0cy5ub3ROdWxsID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgcmV0dXJuICFpc05vdGhpbmcodmFsdWUpO1xufTtcblxubW9kdWxlLmV4cG9ydHMubm90TnVsbElmID0gZnVuY3Rpb24gKHZhbHVlLCBjb25kaXRpb24pIHtcbiAgICByZXR1cm4gIWNvbmRpdGlvbiB8fCAhaXNOb3RoaW5nKHZhbHVlKTtcbn07XG5cbi8qKlxuICogVmFsaWRhdGUgYW4gb2JqIHdpdGggY29uZGl0aW9uIGxpa2UgbW9uZ28tc3R5bGUgcXVlcnlcbiAqIEBwYXJhbSB7Kn0gb2JqIFxuICogQHBhcmFtIHthcnJheXxvYmplY3R9IGNvbmRpdGlvbiBcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5mdW5jdGlvbiB2YWxpZGF0ZShvYmosIGNvbmRpdGlvbikgeyAgICBcbiAgICBjb25zdCB7IFF1ZXJ5IH0gPSB0cnlSZXF1aXJlKCdtaW5nbycpO1xuICAgIGxldCBxdWVyeSA9IG5ldyBRdWVyeShjb25kaXRpb24pO1xuICAgIFxuICAgIC8vIHRlc3QgaWYgYW4gb2JqZWN0IG1hdGNoZXMgcXVlcnlcbiAgICByZXR1cm4gcXVlcnkudGVzdChvYmopO1xufVxuXG5tb2R1bGUuZXhwb3J0cy52YWxpZGF0ZSA9IHZhbGlkYXRlO1xuXG5mdW5jdGlvbiB2YWxpZGF0ZU9iamVjdEJ5U2NoZW1hKHJhdywgc2NoZW1hLCBpMThuLCBwcmVmaXgpIHsgICBcbiAgICBsZXQgbGF0ZXN0ID0ge307XG4gICAgY29uc3QgVHlwZXMgPSByZXF1aXJlKCcuL3R5cGVzJyk7XG5cbiAgICBfLmZvck93bihzY2hlbWEsIChmaWVsZEluZm8sIGZpZWxkTmFtZSkgPT4ge1xuICAgICAgICBpZiAoZmllbGROYW1lIGluIHJhdykge1xuICAgICAgICAgICAgbGV0IHZhbHVlID0gcmF3W2ZpZWxkTmFtZV07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vc2FuaXRpemUgZmlyc3RcbiAgICAgICAgICAgIGlmIChpc05vdGhpbmcodmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFmaWVsZEluZm8ub3B0aW9uYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFZhbGlkYXRpb25FcnJvcihgVmFsdWUgb2YgcHJvcGVydHkgXCIke3ByZWZpeCA/IHByZWZpeCArICcuJyA6ICcnfSR7ZmllbGROYW1lfVwiIGNhbm5vdCBiZSBudWxsYCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGF0ZXN0W2ZpZWxkTmFtZV0gPSBmaWVsZEluZm8uZGVmYXVsdCA/PyBudWxsO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGRJbmZvLnR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbGF0ZXN0W2ZpZWxkTmFtZV0gPSBUeXBlcy5zYW5pdGl6ZSh2YWx1ZSwgZmllbGRJbmZvLCBpMThuLCAocHJlZml4ID8gcHJlZml4ICsgJy4nIDogJycpICsgZmllbGROYW1lKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgeyAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGxhdGVzdFtmaWVsZE5hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gICAgICAgXG5cbiAgICAgICAgaWYgKCFmaWVsZEluZm8ub3B0aW9uYWwpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBWYWxpZGF0aW9uRXJyb3IoYE1pc3NpbmcgcmVxdWlyZWQgcHJvcGVydHkgXCIke3ByZWZpeCA/IHByZWZpeCArICcuJyA6ICcnfSR7ZmllbGROYW1lfVwiYCk7XG4gICAgICAgIH0gICAgICAgIFxuXG4gICAgICAgIGxhdGVzdFtmaWVsZE5hbWVdID0gZmllbGRJbmZvLmRlZmF1bHQgPz8gbnVsbDtcbiAgICB9KTtcblxuICAgIHJldHVybiBsYXRlc3Q7XG59XG5cbm1vZHVsZS5leHBvcnRzLnZhbGlkYXRlT2JqZWN0QnlTY2hlbWEgPSB2YWxpZGF0ZU9iamVjdEJ5U2NoZW1hOyJdfQ==