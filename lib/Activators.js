"use strict";require("source-map-support/register");const{_}=require("rk-utils");const{ApplicationError,RequestError}=require("./utils/Errors");module.exports={datetimeAdd:function(model,context,startTime,duration){return startTime.plus(duration)},isEqual:function(model,context,value1,value2){return value1===value2},triggerUpdate:function(model,context,value,condition){return condition?value:null},sum:(model,context,...args)=>args.reduce((sum,v)=>sum+=v,0),multiply:(model,context,multiplier,multiplicand)=>multiplier*multiplicand,populate:async(model,context,assoc,options)=>{let parts=assoc.split(".");let selectedField=parts.pop();let remoteAssoc=parts.join(".");let localAssoc=parts.shift();let interAssoc;if(parts.length>0){interAssoc=parts.join(".")}if(!context.latest.hasOwnProperty(localAssoc)){return undefined}let assocValue=context.latest[localAssoc];if(_.isNil(assocValue)){throw new ApplicationError(`The value of referenced association "${localAssoc}" of entity "${model.meta.name}" should not be null.`)}let assocMeta=model.meta.associations[localAssoc];if(!assocMeta){throw new ApplicationError(`"${localAssoc}" is not an association field of entity "${model.meta.name}".`)}if(assocMeta.list){throw new ApplicationError(`"${localAssoc}" entity "${model.meta.name}" is a list-style association which is not supported by the built-in populate Activators.`)}let remoteEntity=context.populated&&context.populated[remoteAssoc];if(!remoteEntity){if(options&&options.useCache){remoteEntity=(await model.db.model(assocMeta.entity).cached_(assocMeta.key,interAssoc?[interAssoc]:null,context.connOptions))[assocValue]}else{let findOptions={$query:{[assocMeta.key]:assocValue}};if(interAssoc){findOptions.$associations=[interAssoc]}await model.ensureTransaction_(context);remoteEntity=await model.db.model(assocMeta.entity).findOne_(findOptions,context.connOptions)}if(!remoteEntity){throw new RequestError(`Unable to find the "${assocMeta.entity}" with [${assocMeta.key}=${assocValue}].`)}context.populated||(context.populated={});context.populated[localAssoc]=remoteEntity;let currentAssoc=localAssoc;while(parts.length>0){let nextAssoc=parts.shift();remoteEntity=remoteEntity[":"+nextAssoc];currentAssoc=currentAssoc+"."+nextAssoc;context.populated[currentAssoc]=remoteEntity}}if(!remoteEntity.hasOwnProperty(selectedField)){throw new ApplicationError(`"${selectedField}" is not a field of remote association "${remoteAssoc}" of entity "${model.meta.name}".`)}return remoteEntity[selectedField]}};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9BY3RpdmF0b3JzLmpzIl0sIm5hbWVzIjpbIl8iLCJyZXF1aXJlIiwiQXBwbGljYXRpb25FcnJvciIsIlJlcXVlc3RFcnJvciIsIm1vZHVsZSIsImV4cG9ydHMiLCJkYXRldGltZUFkZCIsIm1vZGVsIiwiY29udGV4dCIsInN0YXJ0VGltZSIsImR1cmF0aW9uIiwicGx1cyIsImlzRXF1YWwiLCJ2YWx1ZTEiLCJ2YWx1ZTIiLCJ0cmlnZ2VyVXBkYXRlIiwidmFsdWUiLCJjb25kaXRpb24iLCJzdW0iLCJhcmdzIiwicmVkdWNlIiwidiIsIm11bHRpcGx5IiwibXVsdGlwbGllciIsIm11bHRpcGxpY2FuZCIsInBvcHVsYXRlIiwiYXNzb2MiLCJvcHRpb25zIiwicGFydHMiLCJzcGxpdCIsInNlbGVjdGVkRmllbGQiLCJwb3AiLCJyZW1vdGVBc3NvYyIsImpvaW4iLCJsb2NhbEFzc29jIiwic2hpZnQiLCJpbnRlckFzc29jIiwibGVuZ3RoIiwibGF0ZXN0IiwiaGFzT3duUHJvcGVydHkiLCJ1bmRlZmluZWQiLCJhc3NvY1ZhbHVlIiwiaXNOaWwiLCJtZXRhIiwibmFtZSIsImFzc29jTWV0YSIsImFzc29jaWF0aW9ucyIsImxpc3QiLCJyZW1vdGVFbnRpdHkiLCJwb3B1bGF0ZWQiLCJ1c2VDYWNoZSIsImRiIiwiZW50aXR5IiwiY2FjaGVkXyIsImtleSIsImNvbm5PcHRpb25zIiwiZmluZE9wdGlvbnMiLCIkcXVlcnkiLCIkYXNzb2NpYXRpb25zIiwiZW5zdXJlVHJhbnNhY3Rpb25fIiwiZmluZE9uZV8iLCJjdXJyZW50QXNzb2MiLCJuZXh0QXNzb2MiXSwibWFwcGluZ3MiOiJBQUFBLGEsdUNBRUEsS0FBTSxDQUFFQSxDQUFGLEVBQVFDLE9BQU8sQ0FBQyxVQUFELENBQXJCLENBQ0EsS0FBTSxDQUFFQyxnQkFBRixDQUFvQkMsWUFBcEIsRUFBcUNGLE9BQU8sQ0FBQyxnQkFBRCxDQUFsRCxDQUVBRyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FDYkMs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QUF5QixDQUNyQixHQUFJeUIsQ0FBQUEsU0FBUyxDQUFHbEMsS0FBSyxDQUFDTyxLQUFOLEVBQWhCLENBQ0FhLFlBQVksQ0FBR0EsWUFBWSxDQUFDLElBQUljLFNBQUwsQ0FBM0IsQ0FHQUQsWUFBWSxDQUFHQSxZQUFZLENBQUMsR0FBYixDQUFpQkMsU0FBaEMsQ0FDQXRELE9BQU8sQ0FBQ3lDLFNBQVIsQ0FBa0JZLFlBQWxCLEVBQWtDYixZQUNyQyxDQUNKLENBRUQsR0FBSSxDQUFDQSxZQUFZLENBQUNULGNBQWIsQ0FBNEJULGFBQTVCLENBQUwsQ0FBaUQsQ0FDN0MsS0FBTSxJQUFJNUIsQ0FBQUEsZ0JBQUosQ0FBc0IsSUFBRzRCLGFBQWMsMkNBQTBDRSxXQUFZLGdCQUFlekIsS0FBSyxDQUFDb0MsSUFBTixDQUFXQyxJQUFLLElBQTVILENBQ1QsQ0FFRCxNQUFPSSxDQUFBQSxZQUFZLENBQUNsQixhQUFELENBQ3RCLENBeEZZLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmNvbnN0IHsgXyB9ID0gcmVxdWlyZSgncmstdXRpbHMnKTtcbmNvbnN0IHsgQXBwbGljYXRpb25FcnJvciwgUmVxdWVzdEVycm9yIH0gPSByZXF1aXJlKCcuL3V0aWxzL0Vycm9ycycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBkYXRldGltZUFkZDogZnVuY3Rpb24gKG1vZGVsLCBjb250ZXh0LCBzdGFydFRpbWUsIGR1cmF0aW9uKSB7XG4gICAgICAgIHJldHVybiBzdGFydFRpbWUucGx1cyhkdXJhdGlvbik7XG4gICAgfSxcblxuICAgIGlzRXF1YWw6IGZ1bmN0aW9uIChtb2RlbCwgY29udGV4dCwgdmFsdWUxLCB2YWx1ZTIpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlMSA9PT0gdmFsdWUyO1xuICAgIH0sXG5cbiAgICB0cmlnZ2VyVXBkYXRlOiBmdW5jdGlvbiAobW9kZWwsIGNvbnRleHQsIHZhbHVlLCBjb25kaXRpb24pIHtcbiAgICAgICAgcmV0dXJuIGNvbmRpdGlvbiA/IHZhbHVlIDogbnVsbDtcbiAgICB9LFxuXG4gICAgc3VtOiAobW9kZWwsIGNvbnRleHQsIC4uLmFyZ3MpID0+IGFyZ3MucmVkdWNlKChzdW0sIHYpID0+IHN1bSArPSB2LCAwKSxcblxuICAgIG11bHRpcGx5OiAobW9kZWwsIGNvbnRleHQsIG11bHRpcGxpZXIsIG11bHRpcGxpY2FuZCkgPT4gbXVsdGlwbGllciptdWx0aXBsaWNhbmQsXG5cbiAgICBwb3B1bGF0ZTogYXN5bmMgKG1vZGVsLCBjb250ZXh0LCBhc3NvYywgb3B0aW9ucykgPT4ge1xuICAgICAgICBsZXQgcGFydHMgPSBhc3NvYy5zcGxpdCgnLicpO1xuICAgICAgICBhc3NlcnQ6IHBhcnRzLmxlbmd0aCA+IDE7XG5cbiAgICAgICAgbGV0IHNlbGVjdGVkRmllbGQgPSBwYXJ0cy5wb3AoKTtcbiAgICAgICAgbGV0IHJlbW90ZUFzc29jID0gcGFydHMuam9pbignLicpO1xuICAgICAgICBsZXQgbG9jYWxBc3NvYyA9IHBhcnRzLnNoaWZ0KCk7XG4gICAgICAgIGxldCBpbnRlckFzc29jO1xuICAgICAgICBcbiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGludGVyQXNzb2MgPSBwYXJ0cy5qb2luKCcuJyk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGlmICghY29udGV4dC5sYXRlc3QuaGFzT3duUHJvcGVydHkobG9jYWxBc3NvYykpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYXNzb2NWYWx1ZSA9IGNvbnRleHQubGF0ZXN0W2xvY2FsQXNzb2NdO1xuICAgICAgICBpZiAoXy5pc05pbChhc3NvY1ZhbHVlKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEFwcGxpY2F0aW9uRXJyb3IoYFRoZSB2YWx1ZSBvZiByZWZlcmVuY2VkIGFzc29jaWF0aW9uIFwiJHtsb2NhbEFzc29jfVwiIG9mIGVudGl0eSBcIiR7bW9kZWwubWV0YS5uYW1lfVwiIHNob3VsZCBub3QgYmUgbnVsbC5gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBhc3NvY01ldGEgPSBtb2RlbC5tZXRhLmFzc29jaWF0aW9uc1tsb2NhbEFzc29jXTtcbiAgICAgICAgaWYgKCFhc3NvY01ldGEpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBBcHBsaWNhdGlvbkVycm9yKGBcIiR7bG9jYWxBc3NvY31cIiBpcyBub3QgYW4gYXNzb2NpYXRpb24gZmllbGQgb2YgZW50aXR5IFwiJHttb2RlbC5tZXRhLm5hbWV9XCIuYCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYXNzb2NNZXRhLmxpc3QpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBBcHBsaWNhdGlvbkVycm9yKGBcIiR7bG9jYWxBc3NvY31cIiBlbnRpdHkgXCIke21vZGVsLm1ldGEubmFtZX1cIiBpcyBhIGxpc3Qtc3R5bGUgYXNzb2NpYXRpb24gd2hpY2ggaXMgbm90IHN1cHBvcnRlZCBieSB0aGUgYnVpbHQtaW4gcG9wdWxhdGUgQWN0aXZhdG9ycy5gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vbG9jYWwgY2FjaGUgaW4gY29udGV4dCwgc2hhcmVkIGJ5IG90aGVyIGZpZWxkcyBpZiBhbnkgXG4gICAgICAgIGxldCByZW1vdGVFbnRpdHkgPSBjb250ZXh0LnBvcHVsYXRlZCAmJiBjb250ZXh0LnBvcHVsYXRlZFtyZW1vdGVBc3NvY107XG4gICAgICAgIGlmICghcmVtb3RlRW50aXR5KSB7XG4gICAgICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnVzZUNhY2hlKSB7XG4gICAgICAgICAgICAgICAgcmVtb3RlRW50aXR5ID0gKGF3YWl0IG1vZGVsLmRiLm1vZGVsKGFzc29jTWV0YS5lbnRpdHkpLmNhY2hlZF8oYXNzb2NNZXRhLmtleSwgaW50ZXJBc3NvYyA/IFsgaW50ZXJBc3NvYyBdIDogbnVsbCwgY29udGV4dC5jb25uT3B0aW9ucykpW2Fzc29jVmFsdWVdOyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbGV0IGZpbmRPcHRpb25zID0geyAkcXVlcnk6IHsgW2Fzc29jTWV0YS5rZXldOiBhc3NvY1ZhbHVlIH0gfTtcblxuICAgICAgICAgICAgICAgIGlmIChpbnRlckFzc29jKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbmRPcHRpb25zLiRhc3NvY2lhdGlvbnMgPSBbIGludGVyQXNzb2MgXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBhd2FpdCBtb2RlbC5lbnN1cmVUcmFuc2FjdGlvbl8oY29udGV4dCk7XG5cbiAgICAgICAgICAgICAgICByZW1vdGVFbnRpdHkgPSBhd2FpdCBtb2RlbC5kYi5tb2RlbChhc3NvY01ldGEuZW50aXR5KS5maW5kT25lXyhmaW5kT3B0aW9ucywgY29udGV4dC5jb25uT3B0aW9ucyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghcmVtb3RlRW50aXR5KSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJlcXVlc3RFcnJvcihgVW5hYmxlIHRvIGZpbmQgdGhlIFwiJHthc3NvY01ldGEuZW50aXR5fVwiIHdpdGggWyR7YXNzb2NNZXRhLmtleX09JHthc3NvY1ZhbHVlfV0uYCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnRleHQucG9wdWxhdGVkIHx8IChjb250ZXh0LnBvcHVsYXRlZCA9IHt9KTtcbiAgICAgICAgICAgIGNvbnRleHQucG9wdWxhdGVkW2xvY2FsQXNzb2NdID0gcmVtb3RlRW50aXR5O1xuXG4gICAgICAgICAgICBsZXQgY3VycmVudEFzc29jID0gbG9jYWxBc3NvYztcbiAgICAgICAgICAgIHdoaWxlIChwYXJ0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgbGV0IG5leHRBc3NvYyA9IHBhcnRzLnNoaWZ0KCk7XG4gICAgICAgICAgICAgICAgcmVtb3RlRW50aXR5ID0gcmVtb3RlRW50aXR5Wyc6JytuZXh0QXNzb2NdO1xuICAgICAgICAgICAgICAgIGFzc2VydDogIUFycmF5LmlzQXJyYXkocmVtb3RlRW50aXR5KTtcblxuICAgICAgICAgICAgICAgIGN1cnJlbnRBc3NvYyA9IGN1cnJlbnRBc3NvYysnLicrbmV4dEFzc29jO1xuICAgICAgICAgICAgICAgIGNvbnRleHQucG9wdWxhdGVkW2N1cnJlbnRBc3NvY10gPSByZW1vdGVFbnRpdHk7ICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyZW1vdGVFbnRpdHkuaGFzT3duUHJvcGVydHkoc2VsZWN0ZWRGaWVsZCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBBcHBsaWNhdGlvbkVycm9yKGBcIiR7c2VsZWN0ZWRGaWVsZH1cIiBpcyBub3QgYSBmaWVsZCBvZiByZW1vdGUgYXNzb2NpYXRpb24gXCIke3JlbW90ZUFzc29jfVwiIG9mIGVudGl0eSBcIiR7bW9kZWwubWV0YS5uYW1lfVwiLmApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlbW90ZUVudGl0eVtzZWxlY3RlZEZpZWxkXTtcbiAgICB9XG59OyJdfQ==