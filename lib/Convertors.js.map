{"version":3,"file":"Convertors.js","names":["validator","require","_","exports","toBoolean","value","toString","toText","noTrim","trim","toInt","radix","isInteger","parseInt","toFloat","isFinite","jsonToBase64","obj","Buffer","from","JSON","stringify","base64ToJson","base64","parse","toKVPairs","arrayOfObjects","property","transformer","keyGetter","reduce","table","toSet","Set","valueGetter","result","forEach","add","mapKeysDeep","object","mapping","keepUnmapped","newObj","forOwn","v","k","nk","Array","isArray","mapArraysDeep","map"],"sources":["../src/Convertors.js"],"sourcesContent":["const validator = require('validator');\nconst { _ } = require('@genx/july');\n\nexports.toBoolean = (value) =>\n    typeof value === 'boolean'\n        ? value\n        : validator.toBoolean(value.toString(), true);\n\nexports.toText = (value, noTrim) => {\n    if (value) {\n        value = typeof value !== 'string' ? value.toString() : value;\n        return noTrim ? value : value.trim();\n    }\n\n    return value;\n};\n\nexports.toInt = (value, radix) =>\n    _.isInteger(value) ? value : parseInt(value, radix);\n\nexports.toFloat = (value) =>\n    _.isFinite(value) ? value : validator.toFloat(value);\n\nexports.jsonToBase64 = (obj) =>\n    Buffer.from(JSON.stringify(obj)).toString('base64');\n\nexports.base64ToJson = (base64) =>\n    JSON.parse(Buffer.from(base64, 'base64').toString('ascii'));\n\nexports.toKVPairs = (arrayOfObjects, property, transformer) => {\n    const keyGetter =\n        typeof property === 'function' ? property : (obj) => obj[property];\n\n    return arrayOfObjects.reduce((table, obj) => {\n        table[keyGetter(obj)] = transformer ? transformer(obj) : obj;\n        return table;\n    }, {});\n};\n\nexports.toSet = (arrayOfObjects, property) => {\n    if (!arrayOfObjects) return new Set();\n\n    const valueGetter =\n        typeof property === 'function' ? property : (obj) => obj[property];\n    const result = new Set();\n\n    arrayOfObjects.forEach((obj) => result.add(valueGetter(obj)));\n\n    return result;\n};\n\n/**\n * Remap the keys of object elements in an array, like projection.\n * @param {*} object\n * @param {*} mapping - key to newKey or key to array[ newKey, valueMap ] for next level mapping\n * @param {boolean} keepUnmapped - If true, will keep those not in mapping as its original key, otherwise filter out\n */\nconst mapKeysDeep = (object, mapping, keepUnmapped) => {\n    if (typeof mapping === 'string') return { [mapping]: object };\n\n    const newObj = {};\n    _.forOwn(object, (v, k) => {\n        if (k in mapping) {\n            const nk = mapping[k];\n            if (Array.isArray(nk)) {\n                newObj[nk[0]] = {\n                    ...newObj[nk[0]],\n                    ...mapKeysDeep(v, nk[1], keepUnmapped),\n                };\n            } else {\n                newObj[nk] = v;\n            }\n        } else {\n            if (keepUnmapped) {\n                newObj[k] = v;\n            }\n        }\n    });\n\n    return newObj;\n};\n\nconst mapArraysDeep = (arrayOfObjects, mapping, keepUnmapped) =>\n    _.map(arrayOfObjects, (obj) => mapKeysDeep(obj, mapping, keepUnmapped));\n\nexports.mapKeysDeep = mapKeysDeep;\nexports.mapArraysDeep = mapArraysDeep;\n"],"mappings":";;;;AAAA,MAAMA,SAAS,GAAGC,OAAO,CAAC,WAAD,CAAzB;;AACA,MAAM;EAAEC;AAAF,IAAQD,OAAO,CAAC,YAAD,CAArB;;AAEAE,OAAO,CAACC,SAAR,GAAqBC,KAAD,IAChB,OAAOA,KAAP,KAAiB,SAAjB,GACMA,KADN,GAEML,SAAS,CAACI,SAAV,CAAoBC,KAAK,CAACC,QAAN,EAApB,EAAsC,IAAtC,CAHV;;AAKAH,OAAO,CAACI,MAAR,GAAiB,CAACF,KAAD,EAAQG,MAAR,KAAmB;EAChC,IAAIH,KAAJ,EAAW;IACPA,KAAK,GAAG,OAAOA,KAAP,KAAiB,QAAjB,GAA4BA,KAAK,CAACC,QAAN,EAA5B,GAA+CD,KAAvD;IACA,OAAOG,MAAM,GAAGH,KAAH,GAAWA,KAAK,CAACI,IAAN,EAAxB;EACH;;EAED,OAAOJ,KAAP;AACH,CAPD;;AASAF,OAAO,CAACO,KAAR,GAAgB,CAACL,KAAD,EAAQM,KAAR,KACZT,CAAC,CAACU,SAAF,CAAYP,KAAZ,IAAqBA,KAArB,GAA6BQ,QAAQ,CAACR,KAAD,EAAQM,KAAR,CADzC;;AAGAR,OAAO,CAACW,OAAR,GAAmBT,KAAD,IACdH,CAAC,CAACa,QAAF,CAAWV,KAAX,IAAoBA,KAApB,GAA4BL,SAAS,CAACc,OAAV,CAAkBT,KAAlB,CADhC;;AAGAF,OAAO,CAACa,YAAR,GAAwBC,GAAD,IACnBC,MAAM,CAACC,IAAP,CAAYC,IAAI,CAACC,SAAL,CAAeJ,GAAf,CAAZ,EAAiCX,QAAjC,CAA0C,QAA1C,CADJ;;AAGAH,OAAO,CAACmB,YAAR,GAAwBC,MAAD,IACnBH,IAAI,CAACI,KAAL,CAAWN,MAAM,CAACC,IAAP,CAAYI,MAAZ,EAAoB,QAApB,EAA8BjB,QAA9B,CAAuC,OAAvC,CAAX,CADJ;;AAGAH,OAAO,CAACsB,SAAR,GAAoB,CAACC,cAAD,EAAiBC,QAAjB,EAA2BC,WAA3B,KAA2C;EAC3D,MAAMC,SAAS,GACX,OAAOF,QAAP,KAAoB,UAApB,GAAiCA,QAAjC,GAA6CV,GAAD,IAASA,GAAG,CAACU,QAAD,CAD5D;EAGA,OAAOD,cAAc,CAACI,MAAf,CAAsB,CAACC,KAAD,EAAQd,GAAR,KAAgB;IACzCc,KAAK,CAACF,SAAS,CAACZ,GAAD,CAAV,CAAL,GAAwBW,WAAW,GAAGA,WAAW,CAACX,GAAD,CAAd,GAAsBA,GAAzD;IACA,OAAOc,KAAP;EACH,CAHM,EAGJ,EAHI,CAAP;AAIH,CARD;;AAUA5B,OAAO,CAAC6B,KAAR,GAAgB,CAACN,cAAD,EAAiBC,QAAjB,KAA8B;EAC1C,IAAI,CAACD,cAAL,EAAqB,OAAO,IAAIO,GAAJ,EAAP;EAErB,MAAMC,WAAW,GACb,OAAOP,QAAP,KAAoB,UAApB,GAAiCA,QAAjC,GAA6CV,GAAD,IAASA,GAAG,CAACU,QAAD,CAD5D;EAEA,MAAMQ,MAAM,GAAG,IAAIF,GAAJ,EAAf;EAEAP,cAAc,CAACU,OAAf,CAAwBnB,GAAD,IAASkB,MAAM,CAACE,GAAP,CAAWH,WAAW,CAACjB,GAAD,CAAtB,CAAhC;EAEA,OAAOkB,MAAP;AACH,CAVD;;AAkBA,MAAMG,WAAW,GAAG,CAACC,MAAD,EAASC,OAAT,EAAkBC,YAAlB,KAAmC;EACnD,IAAI,OAAOD,OAAP,KAAmB,QAAvB,EAAiC,OAAO;IAAE,CAACA,OAAD,GAAWD;EAAb,CAAP;EAEjC,MAAMG,MAAM,GAAG,EAAf;;EACAxC,CAAC,CAACyC,MAAF,CAASJ,MAAT,EAAiB,CAACK,CAAD,EAAIC,CAAJ,KAAU;IACvB,IAAIA,CAAC,IAAIL,OAAT,EAAkB;MACd,MAAMM,EAAE,GAAGN,OAAO,CAACK,CAAD,CAAlB;;MACA,IAAIE,KAAK,CAACC,OAAN,CAAcF,EAAd,CAAJ,EAAuB;QACnBJ,MAAM,CAACI,EAAE,CAAC,CAAD,CAAH,CAAN,GAAgB,EACZ,GAAGJ,MAAM,CAACI,EAAE,CAAC,CAAD,CAAH,CADG;UAEZ,GAAGR,WAAW,CAACM,CAAD,EAAIE,EAAE,CAAC,CAAD,CAAN,EAAWL,YAAX;QAFF,CAAhB;MAIH,CALD,MAKO;QACHC,MAAM,CAACI,EAAD,CAAN,GAAaF,CAAb;MACH;IACJ,CAVD,MAUO;MACH,IAAIH,YAAJ,EAAkB;QACdC,MAAM,CAACG,CAAD,CAAN,GAAYD,CAAZ;MACH;IACJ;EACJ,CAhBD;;EAkBA,OAAOF,MAAP;AACH,CAvBD;;AAyBA,MAAMO,aAAa,GAAG,CAACvB,cAAD,EAAiBc,OAAjB,EAA0BC,YAA1B,KAClBvC,CAAC,CAACgD,GAAF,CAAMxB,cAAN,EAAuBT,GAAD,IAASqB,WAAW,CAACrB,GAAD,EAAMuB,OAAN,EAAeC,YAAf,CAA1C,CADJ;;AAGAtC,OAAO,CAACmC,WAAR,GAAsBA,WAAtB;AACAnC,OAAO,CAAC8C,aAAR,GAAwBA,aAAxB"}