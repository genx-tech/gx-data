{"version":3,"file":"Convertors.js","names":["validator","require","_","exports","toBoolean","value","toString","toText","noTrim","trim","toInt","radix","isInteger","parseInt","NaN","toFloat","isFinite","jsonToBase64","obj","Buffer","from","JSON","stringify","base64ToJson","base64","parse","toKVPairs","arrayOfObjects","property","transformer","keyGetter","reduce","table","toSet","Set","valueGetter","result","forEach","add","mapKeysDeep","object","mapping","keepUnmapped","newObj","forOwn","v","k","nk","Array","isArray","mapArraysDeep","map"],"sources":["../src/Convertors.js"],"sourcesContent":["const validator = require('validator');\nconst { _ } = require('@genx/july');\n\nexports.toBoolean = (value) =>\n    typeof value === 'boolean'\n        ? value\n        : validator.toBoolean(value.toString(), true);\n\nexports.toText = (value, noTrim) => {\n    if (value) {\n        value = typeof value !== 'string' ? value.toString() : value;\n        return noTrim ? value : value.trim();\n    }\n\n    return value;\n};\n\nexports.toInt = (value, radix) =>\n    _.isInteger(value) ? value : (typeof value === 'string' ? parseInt(value, radix) : NaN);\n\nexports.toFloat = (value) =>\n    _.isFinite(value) ? value : validator.toFloat(value);\n\nexports.jsonToBase64 = (obj) =>\n    Buffer.from(JSON.stringify(obj)).toString('base64');\n\nexports.base64ToJson = (base64) =>\n    JSON.parse(Buffer.from(base64, 'base64').toString('ascii'));\n\nexports.toKVPairs = (arrayOfObjects, property, transformer) => {\n    const keyGetter =\n        typeof property === 'function' ? property : (obj) => obj[property];\n\n    return arrayOfObjects.reduce((table, obj) => {\n        table[keyGetter(obj)] = transformer ? transformer(obj) : obj;\n        return table;\n    }, {});\n};\n\nexports.toSet = (arrayOfObjects, property) => {\n    if (!arrayOfObjects) return new Set();\n\n    const valueGetter =\n        typeof property === 'function' ? property : (obj) => obj[property];\n    const result = new Set();\n\n    arrayOfObjects.forEach((obj) => result.add(valueGetter(obj)));\n\n    return result;\n};\n\n/**\n * Remap the keys of object elements in an array, like projection.\n * @param {*} object\n * @param {*} mapping - key to newKey or key to array[ newKey, valueMap ] for next level mapping\n * @param {boolean} keepUnmapped - If true, will keep those not in mapping as its original key, otherwise filter out\n */\nconst mapKeysDeep = (object, mapping, keepUnmapped) => {\n    if (typeof mapping === 'string') return { [mapping]: object };\n\n    const newObj = {};\n    _.forOwn(object, (v, k) => {\n        if (k in mapping) {\n            const nk = mapping[k];\n            if (Array.isArray(nk)) {\n                newObj[nk[0]] = {\n                    ...newObj[nk[0]],\n                    ...mapKeysDeep(v, nk[1], keepUnmapped),\n                };\n            } else {\n                newObj[nk] = v;\n            }\n        } else {\n            if (keepUnmapped) {\n                newObj[k] = v;\n            }\n        }\n    });\n\n    return newObj;\n};\n\nconst mapArraysDeep = (arrayOfObjects, mapping, keepUnmapped) =>\n    _.map(arrayOfObjects, (obj) => mapKeysDeep(obj, mapping, keepUnmapped));\n\nexports.mapKeysDeep = mapKeysDeep;\nexports.mapArraysDeep = mapArraysDeep;\n"],"mappings":"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"}