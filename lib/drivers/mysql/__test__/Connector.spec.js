'use strict';

require("source-map-support/register");

const winston = require('winston');

const Connector = require('../Connector');

const TEST_DB = 'oolong-unit-test';
describe('unit:connector:mysql', function () {
  let logger = winston.createLogger({
    "level": "verbose",
    "transports": [new winston.transports.Console({
      "format": winston.format.combine(winston.format.colorize(), winston.format.simple())
    })]
  });
  let connector;
  before(async function () {
    connector = new Connector(`mysql://root:root@localhost/${TEST_DB}`, {
      logger,
      logStatement: true
    });
    await connector.execute_('CREATE DATABASE IF NOT EXISTS ?? CHARACTER SET ?? COLLATE ??', [TEST_DB, 'utf8mb4', 'utf8mb4_0900_ai_ci'], {
      createDatabase: true
    });
    await connector.execute_('CREATE TABLE IF NOT EXISTS ?? (a INT NOT NULL PRIMARY KEY, b INT) ENGINE = InnoDB', ['t']);
    await connector.execute_('CREATE TABLE IF NOT EXISTS ?? (a INT NOT NULL PRIMARY KEY, b INT) ENGINE = InnoDB', ['t2']);
    await connector.execute_('TRUNCATE TABLE ??', ['t']);
  });
  after(async function () {
    await connector.execute_('DROP DATABASE IF EXISTS ??', [TEST_DB]);
    await connector.end_();
  });
  describe('basic', function () {
    it('ping', async function () {
      let alive = await connector.ping_();
      alive.should.be.ok();
    });
  });
  describe('crud', function () {
    it('insert', async function () {
      let result = await connector.create_('t', {
        a: 1,
        b: 2
      });
      connector.getNumOfAffectedRows(result).should.be.exactly(1);
    });
    it('insert duplicate', async function () {
      (async () => connector.create_('t', {
        a: 1,
        b: 2
      }))().should.be.rejectedWith("Duplicate entry '1' for key 'PRIMARY'");
    });
    it('update', async function () {
      let result = await connector.update_('t', {
        b: 1
      }, {
        a: 1
      });
      connector.getNumOfAffectedRows(result).should.be.exactly(1);
    });
    it('find', async function () {
      let result = await connector.find_('t', {
        $query: {
          a: 1
        }
      });
      result.length.should.be.exactly(1);
      result[0].b.should.be.exactly(1);
    });
    it('find with count', async function () {
      let result = await connector.find_('t', {
        $projection: {
          type: 'function',
          name: 'count',
          args: ['a'],
          alias: 'count'
        },
        $query: {
          a: 1
        }
      });
      result.length.should.be.exactly(1);
      result[0].count.should.be.exactly(1);
    });
    it('find order by', async function () {
      let result = await connector.create_('t', {
        a: 3,
        b: 2
      });
      result = await connector.create_('t', {
        a: 2,
        b: 3
      });
      result = await connector.find_('t', {
        $projection: '*',
        $orderBy: {
          a: true
        }
      });
      result.length.should.be.exactly(3);
      result[0].a.should.be.exactly(1);
      result[1].a.should.be.exactly(2);
      result[2].a.should.be.exactly(3);
      result = await connector.find_('t', {
        $projection: '*',
        $orderBy: {
          b: false
        }
      });
      result.length.should.be.exactly(3);
      result[0].b.should.be.exactly(3);
      result[1].b.should.be.exactly(2);
      result[2].b.should.be.exactly(1);
    });
    it('find limit', async function () {
      let result = await connector.find_('t', {
        $projection: '*',
        $limit: 1,
        $offset: 0
      });
      result.length.should.be.exactly(1);
      result = await connector.find_('t', {
        $projection: '*',
        $orderBy: {
          b: false
        },
        $limit: 1,
        $offset: 1
      });
      result.length.should.be.exactly(1);
      result[0].b.should.be.exactly(2);
    });
    it('delete', async function () {
      let result = await connector.delete_('t', {
        a: 1
      });
      connector.getNumOfAffectedRows(result).should.be.exactly(1);
      result = await connector.find_('t', {
        $projection: {
          type: 'function',
          name: 'count',
          args: ['a'],
          alias: 'count'
        },
        $query: {
          a: 1
        }
      });
      result.length.should.be.exactly(1);
      result[0].count.should.be.exactly(0);
    });
  });
  describe('transaction', function () {
    it('commit', async function () {
      let conn = await connector.beginTransaction_();
      let result1 = await connector.create_('t', {
        a: 20,
        b: 13
      }, {
        connection: conn
      });
      result1.affectedRows.should.be.exactly(1);
      let result2 = await connector.create_('t2', {
        a: 2,
        b: 1
      }, {
        connection: conn
      });
      result2.affectedRows.should.be.exactly(1);
      let result3 = await connector.update_('t2', {
        b: 20
      }, {
        a: 2
      }, null, {
        connection: conn
      });
      result3.affectedRows.should.be.exactly(1);
      let result4 = await connector.find_('t2', {
        $query: {
          a: 2
        }
      }, {
        connection: conn
      });
      await connector.commit_(conn);
      console.log(result4);
      result4[0].b.should.be.exactly(20);
      let result5 = await connector.find_('t', {
        $query: {
          a: 20
        }
      });
      console.log(result5);
      result5[0].b.should.be.exactly(13);
      await connector.delete_('t', {
        a: 20
      });
      await connector.delete_('t2', {
        a: 2
      });
    });
    it('rollback', async function () {
      let conn = await connector.beginTransaction_();
      await connector.create_('t', {
        a: 20,
        b: 13
      }, {
        connection: conn
      });
      await connector.create_('t2', {
        a: 2,
        b: 1
      }, {
        connection: conn
      });
      await connector.update_('t2', {
        b: 20
      }, {
        a: 2
      }, null, {
        connection: conn
      });
      await connector.rollback_(conn);
      let result4 = await connector.find_('t2', {
        $query: {
          a: 2
        }
      });
      result4.length.should.be.exactly(0);
      let result5 = await connector.find_('t', {
        $query: {
          a: 20
        }
      });
      result5.length.should.be.exactly(0);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9kcml2ZXJzL215c3FsL19fdGVzdF9fL0Nvbm5lY3Rvci5zcGVjLmpzIl0sIm5hbWVzIjpbIndpbnN0b24iLCJyZXF1aXJlIiwiQ29ubmVjdG9yIiwiVEVTVF9EQiIsImRlc2NyaWJlIiwibG9nZ2VyIiwiY3JlYXRlTG9nZ2VyIiwidHJhbnNwb3J0cyIsIkNvbnNvbGUiLCJmb3JtYXQiLCJjb21iaW5lIiwiY29sb3JpemUiLCJzaW1wbGUiLCJjb25uZWN0b3IiLCJiZWZvcmUiLCJsb2dTdGF0ZW1lbnQiLCJleGVjdXRlXyIsImNyZWF0ZURhdGFiYXNlIiwiYWZ0ZXIiLCJlbmRfIiwiaXQiLCJhbGl2ZSIsInBpbmdfIiwic2hvdWxkIiwiYmUiLCJvayIsInJlc3VsdCIsImNyZWF0ZV8iLCJhIiwiYiIsImdldE51bU9mQWZmZWN0ZWRSb3dzIiwiZXhhY3RseSIsInJlamVjdGVkV2l0aCIsInVwZGF0ZV8iLCJmaW5kXyIsIiRxdWVyeSIsImxlbmd0aCIsIiRwcm9qZWN0aW9uIiwidHlwZSIsIm5hbWUiLCJhcmdzIiwiYWxpYXMiLCJjb3VudCIsIiRvcmRlckJ5IiwiJGxpbWl0IiwiJG9mZnNldCIsImRlbGV0ZV8iLCJjb25uIiwiYmVnaW5UcmFuc2FjdGlvbl8iLCJyZXN1bHQxIiwiY29ubmVjdGlvbiIsImFmZmVjdGVkUm93cyIsInJlc3VsdDIiLCJyZXN1bHQzIiwicmVzdWx0NCIsImNvbW1pdF8iLCJjb25zb2xlIiwibG9nIiwicmVzdWx0NSIsInJvbGxiYWNrXyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFFQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFELENBQXZCOztBQUNBLE1BQU1DLFNBQVMsR0FBR0QsT0FBTyxDQUFDLGNBQUQsQ0FBekI7O0FBRUEsTUFBTUUsT0FBTyxHQUFHLGtCQUFoQjtBQUVBQyxRQUFRLENBQUMsc0JBQUQsRUFBeUIsWUFBWTtBQUN6QyxNQUFJQyxNQUFNLEdBQUdMLE9BQU8sQ0FBQ00s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LENBQUNxQixLQUFWLENBQWdCLEdBQWhCLEVBQXFCO0FBQUVDLFFBQUFBLE1BQU0sRUFBRTtBQUFFUCxVQUFBQSxDQUFDLEVBQUU7QUFBTDtBQUFWLE9BQXJCLENBQXBCO0FBQ0E4QixNQUFBQSxPQUFPLENBQUN0QixNQUFSLENBQWViLE1BQWYsQ0FBc0JDLEVBQXRCLENBQXlCTyxPQUF6QixDQUFpQyxDQUFqQztBQUNILEtBdEJDLENBQUY7QUF1QkgsR0E1RE8sQ0FBUjtBQTZESCxDQW5LTyxDQUFSIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCB3aW5zdG9uID0gcmVxdWlyZSgnd2luc3RvbicpO1xuY29uc3QgQ29ubmVjdG9yID0gcmVxdWlyZSgnLi4vQ29ubmVjdG9yJyk7XG5cbmNvbnN0IFRFU1RfREIgPSAnb29sb25nLXVuaXQtdGVzdCc7XG5cbmRlc2NyaWJlKCd1bml0OmNvbm5lY3RvcjpteXNxbCcsIGZ1bmN0aW9uICgpIHsgICAgXG4gICAgbGV0IGxvZ2dlciA9IHdpbnN0b24uY3JlYXRlTG9nZ2VyKHtcbiAgICAgICAgXCJsZXZlbFwiOiBcInZlcmJvc2VcIixcbiAgICAgICAgXCJ0cmFuc3BvcnRzXCI6IFtcbiAgICAgICAgICAgIG5ldyB3aW5zdG9uLnRyYW5zcG9ydHMuQ29uc29sZSh7ICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFwiZm9ybWF0XCI6IHdpbnN0b24uZm9ybWF0LmNvbWJpbmUod2luc3Rvbi5mb3JtYXQuY29sb3JpemUoKSwgd2luc3Rvbi5mb3JtYXQuc2ltcGxlKCkpXG4gICAgICAgICAgICB9KVxuICAgICAgICBdXG4gICAgfSk7XG5cbiAgICBsZXQgY29ubmVjdG9yOyAgICBcblxuICAgIGJlZm9yZShhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbm5lY3RvciA9IG5ldyBDb25uZWN0b3IoYG15c3FsOi8vcm9vdDpyb290QGxvY2FsaG9zdC8ke1RFU1RfREJ9YCwgeyBsb2dnZXIsIGxvZ1N0YXRlbWVudDogdHJ1ZSB9KTtcblxuICAgICAgICBhd2FpdCBjb25uZWN0b3IuZXhlY3V0ZV8oJ0NSRUFURSBEQVRBQkFTRSBJRiBOT1QgRVhJU1RTID8/IENIQVJBQ1RFUiBTRVQgPz8gQ09MTEFURSA/PycsIFxuICAgICAgICAgICAgWyBURVNUX0RCLCAndXRmOG1iNCcsICd1dGY4bWI0XzA5MDBfYWlfY2knIF0sIHsgY3JlYXRlRGF0YWJhc2U6IHRydWUgfSk7XG5cbiAgICAgICAgYXdhaXQgY29ubmVjdG9yLmV4ZWN1dGVfKCdDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyA/PyAoYSBJTlQgTk9UIE5VTEwgUFJJTUFSWSBLRVksIGIgSU5UKSBFTkdJTkUgPSBJbm5vREInLCBcbiAgICAgICAgICAgIFsgJ3QnIF0pO1xuXG4gICAgICAgIGF3YWl0IGNvbm5lY3Rvci5leGVjdXRlXygnQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgPz8gKGEgSU5UIE5PVCBOVUxMIFBSSU1BUlkgS0VZLCBiIElOVCkgRU5HSU5FID0gSW5ub0RCJywgXG4gICAgICAgICAgICBbICd0MicgXSk7ICAgIFxuXG4gICAgICAgIGF3YWl0IGNvbm5lY3Rvci5leGVjdXRlXygnVFJVTkNBVEUgVEFCTEUgPz8nLCAgWyAndCcgXSk7ICAgIFxuICAgIH0pO1xuXG4gICAgYWZ0ZXIoYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICBhd2FpdCBjb25uZWN0b3IuZXhlY3V0ZV8oJ0RST1AgREFUQUJBU0UgSUYgRVhJU1RTID8/JywgWyBURVNUX0RCIF0pO1xuICAgICAgICBhd2FpdCBjb25uZWN0b3IuZW5kXygpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2Jhc2ljJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpdCgncGluZycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxldCBhbGl2ZSA9IGF3YWl0IGNvbm5lY3Rvci5waW5nXygpO1xuICAgICAgICAgICAgYWxpdmUuc2hvdWxkLmJlLm9rKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2NydWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGl0KCdpbnNlcnQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgY29ubmVjdG9yLmNyZWF0ZV8oJ3QnLCB7IGE6IDEsIGI6IDIgfSk7XG4gICAgICAgICAgICBjb25uZWN0b3IuZ2V0TnVtT2ZBZmZlY3RlZFJvd3MocmVzdWx0KS5zaG91bGQuYmUuZXhhY3RseSgxKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ2luc2VydCBkdXBsaWNhdGUnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAoYXN5bmMgKCkgPT4gY29ubmVjdG9yLmNyZWF0ZV8oJ3QnLCB7IGE6IDEsIGI6IDIgfSkpKCkuc2hvdWxkLmJlLnJlamVjdGVkV2l0aChcIkR1cGxpY2F0ZSBlbnRyeSAnMScgZm9yIGtleSAnUFJJTUFSWSdcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCd1cGRhdGUnLCBhc3luYyBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBjb25uZWN0b3IudXBkYXRlXygndCcsIHsgYjogMSB9LCB7IGE6IDEgfSk7XG4gICAgICAgICAgICBjb25uZWN0b3IuZ2V0TnVtT2ZBZmZlY3RlZFJvd3MocmVzdWx0KS5zaG91bGQuYmUuZXhhY3RseSgxKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ2ZpbmQnLCBhc3luYyBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBjb25uZWN0b3IuZmluZF8oJ3QnLCB7ICRxdWVyeTogeyBhOiAxIH0gfSk7XG4gICAgICAgICAgICByZXN1bHQubGVuZ3RoLnNob3VsZC5iZS5leGFjdGx5KDEpOyAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzdWx0WzBdLmIuc2hvdWxkLmJlLmV4YWN0bHkoMSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdmaW5kIHdpdGggY291bnQnLCBhc3luYyBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBjb25uZWN0b3IuZmluZF8oJ3QnLCB7ICRwcm9qZWN0aW9uOiB7IHR5cGU6ICdmdW5jdGlvbicsIG5hbWU6ICdjb3VudCcsIGFyZ3M6IFsgJ2EnIF0sIGFsaWFzOiAnY291bnQnIH0sICRxdWVyeTogeyBhOiAxIH0gfSk7XG4gICAgICAgICAgICByZXN1bHQubGVuZ3RoLnNob3VsZC5iZS5leGFjdGx5KDEpOyAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzdWx0WzBdLmNvdW50LnNob3VsZC5iZS5leGFjdGx5KDEpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnZmluZCBvcmRlciBieScsIGFzeW5jIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0IGNvbm5lY3Rvci5jcmVhdGVfKCd0JywgeyBhOiAzLCBiOiAyIH0pO1xuICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgY29ubmVjdG9yLmNyZWF0ZV8oJ3QnLCB7IGE6IDIsIGI6IDMgfSk7XG5cbiAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IGNvbm5lY3Rvci5maW5kXygndCcsIHsgJHByb2plY3Rpb246ICcqJywgJG9yZGVyQnk6IHsgYTogdHJ1ZSB9IH0pO1xuICAgICAgICAgICAgcmVzdWx0Lmxlbmd0aC5zaG91bGQuYmUuZXhhY3RseSgzKTsgICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc3VsdFswXS5hLnNob3VsZC5iZS5leGFjdGx5KDEpO1xuICAgICAgICAgICAgcmVzdWx0WzFdLmEuc2hvdWxkLmJlLmV4YWN0bHkoMik7XG4gICAgICAgICAgICByZXN1bHRbMl0uYS5zaG91bGQuYmUuZXhhY3RseSgzKTtcblxuICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgY29ubmVjdG9yLmZpbmRfKCd0JywgeyAkcHJvamVjdGlvbjogJyonLCAkb3JkZXJCeTogeyBiOiBmYWxzZSB9IH0pO1xuICAgICAgICAgICAgcmVzdWx0Lmxlbmd0aC5zaG91bGQuYmUuZXhhY3RseSgzKTsgICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc3VsdFswXS5iLnNob3VsZC5iZS5leGFjdGx5KDMpO1xuICAgICAgICAgICAgcmVzdWx0WzFdLmIuc2hvdWxkLmJlLmV4YWN0bHkoMik7XG4gICAgICAgICAgICByZXN1bHRbMl0uYi5zaG91bGQuYmUuZXhhY3RseSgxKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ2ZpbmQgbGltaXQnLCBhc3luYyBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBjb25uZWN0b3IuZmluZF8oJ3QnLCB7ICRwcm9qZWN0aW9uOiAnKicsICRsaW1pdDogMSwgJG9mZnNldDogMCB9KTtcbiAgICAgICAgICAgIHJlc3VsdC5sZW5ndGguc2hvdWxkLmJlLmV4YWN0bHkoMSk7XG5cbiAgICAgICAgICAgIHJlc3VsdCA9IGF3YWl0IGNvbm5lY3Rvci5maW5kXygndCcsIHsgJHByb2plY3Rpb246ICcqJywgJG9yZGVyQnk6IHsgYjogZmFsc2UgfSwgJGxpbWl0OiAxLCAkb2Zmc2V0OiAxIH0pO1xuICAgICAgICAgICAgcmVzdWx0Lmxlbmd0aC5zaG91bGQuYmUuZXhhY3RseSgxKTsgICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc3VsdFswXS5iLnNob3VsZC5iZS5leGFjdGx5KDIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnZGVsZXRlJywgYXN5bmMgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgY29ubmVjdG9yLmRlbGV0ZV8oJ3QnLCB7IGE6IDEgfSk7XG4gICAgICAgICAgICBjb25uZWN0b3IuZ2V0TnVtT2ZBZmZlY3RlZFJvd3MocmVzdWx0KS5zaG91bGQuYmUuZXhhY3RseSgxKTtcblxuICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgY29ubmVjdG9yLmZpbmRfKCd0JywgeyAkcHJvamVjdGlvbjogeyB0eXBlOiAnZnVuY3Rpb24nLCBuYW1lOiAnY291bnQnLCBhcmdzOiBbICdhJyBdLCBhbGlhczogJ2NvdW50JyB9LCAkcXVlcnk6IHsgYTogMSB9IH0pO1xuICAgICAgICAgICAgcmVzdWx0Lmxlbmd0aC5zaG91bGQuYmUuZXhhY3RseSgxKTsgICAgICAgICAgICBcbiAgICAgICAgICAgIHJlc3VsdFswXS5jb3VudC5zaG91bGQuYmUuZXhhY3RseSgwKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgndHJhbnNhY3Rpb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGl0KCdjb21taXQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsZXQgY29ubiA9IGF3YWl0IGNvbm5lY3Rvci5iZWdpblRyYW5zYWN0aW9uXygpO1xuXG4gICAgICAgICAgICBsZXQgcmVzdWx0MSA9IGF3YWl0IGNvbm5lY3Rvci5jcmVhdGVfKCd0JywgeyBcbiAgICAgICAgICAgICAgICBhOiAyMCwgYjogMTMgXG4gICAgICAgICAgICB9LCB7IGNvbm5lY3Rpb246IGNvbm4gfSk7XG5cbiAgICAgICAgICAgIHJlc3VsdDEuYWZmZWN0ZWRSb3dzLnNob3VsZC5iZS5leGFjdGx5KDEpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBsZXQgcmVzdWx0MiA9IGF3YWl0IGNvbm5lY3Rvci5jcmVhdGVfKCd0MicsIHsgXG4gICAgICAgICAgICAgICAgYTogMiwgYjogMVxuICAgICAgICAgICAgfSwgeyBjb25uZWN0aW9uOiBjb25uIH0pO1xuXG4gICAgICAgICAgICByZXN1bHQyLmFmZmVjdGVkUm93cy5zaG91bGQuYmUuZXhhY3RseSgxKTtcblxuICAgICAgICAgICAgbGV0IHJlc3VsdDMgPSBhd2FpdCBjb25uZWN0b3IudXBkYXRlXygndDInLCB7IFxuICAgICAgICAgICAgICAgIGI6IDIwXG4gICAgICAgICAgICB9LCB7IGE6IDIgfSwgbnVsbCwgeyBjb25uZWN0aW9uOiBjb25uIH0pO1xuXG4gICAgICAgICAgICByZXN1bHQzLmFmZmVjdGVkUm93cy5zaG91bGQuYmUuZXhhY3RseSgxKTtcblxuICAgICAgICAgICAgbGV0IHJlc3VsdDQgPSBhd2FpdCBjb25uZWN0b3IuZmluZF8oJ3QyJywgeyAkcXVlcnk6IHsgYTogMiB9IH0sIHsgY29ubmVjdGlvbjogY29ubiB9KTtcbiAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rvci5jb21taXRfKGNvbm4pO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQ0KTtcblxuICAgICAgICAgICAgcmVzdWx0NFswXS5iLnNob3VsZC5iZS5leGFjdGx5KDIwKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbGV0IHJlc3VsdDUgPSBhd2FpdCBjb25uZWN0b3IuZmluZF8oJ3QnLCB7ICRxdWVyeTogeyBhOiAyMCB9IH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzdWx0NSk7XG4gICAgICAgICAgICByZXN1bHQ1WzBdLmIuc2hvdWxkLmJlLmV4YWN0bHkoMTMpO1xuXG4gICAgICAgICAgICBhd2FpdCBjb25uZWN0b3IuZGVsZXRlXygndCcsIHsgYTogMjAgfSk7XG4gICAgICAgICAgICBhd2FpdCBjb25uZWN0b3IuZGVsZXRlXygndDInLCB7IGE6IDIgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdyb2xsYmFjaycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGxldCBjb25uID0gYXdhaXQgY29ubmVjdG9yLmJlZ2luVHJhbnNhY3Rpb25fKCk7XG5cbiAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rvci5jcmVhdGVfKCd0JywgeyBcbiAgICAgICAgICAgICAgICBhOiAyMCwgYjogMTMgXG4gICAgICAgICAgICB9LCB7IGNvbm5lY3Rpb246IGNvbm4gfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGNvbm5lY3Rvci5jcmVhdGVfKCd0MicsIHsgXG4gICAgICAgICAgICAgICAgYTogMiwgYjogMVxuICAgICAgICAgICAgfSwgeyBjb25uZWN0aW9uOiBjb25uIH0pO1xuXG4gICAgICAgICAgICBhd2FpdCBjb25uZWN0b3IudXBkYXRlXygndDInLCB7IFxuICAgICAgICAgICAgICAgIGI6IDIwXG4gICAgICAgICAgICB9LCB7IGE6IDIgfSwgbnVsbCwgeyBjb25uZWN0aW9uOiBjb25uIH0pOyAgICAgIFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCBjb25uZWN0b3Iucm9sbGJhY2tfKGNvbm4pO1xuXG4gICAgICAgICAgICBsZXQgcmVzdWx0NCA9IGF3YWl0IGNvbm5lY3Rvci5maW5kXygndDInLCB7ICRxdWVyeSA6IHsgYTogMiB9IH0pOyAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzdWx0NC5sZW5ndGguc2hvdWxkLmJlLmV4YWN0bHkoMCk7XG5cbiAgICAgICAgICAgIGxldCByZXN1bHQ1ID0gYXdhaXQgY29ubmVjdG9yLmZpbmRfKCd0JywgeyAkcXVlcnk6IHsgYTogMjAgfSB9KTtcbiAgICAgICAgICAgIHJlc3VsdDUubGVuZ3RoLnNob3VsZC5iZS5leGFjdGx5KDApO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn0pOyJdfQ==