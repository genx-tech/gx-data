{"version":3,"sources":["../../src/utils/lang.js"],"names":["_","require","SupportedDrivers","JsPrimitiveTypes","Set","mergeCondition","condition1","condition2","operator","isEmpty","exports","isNothing","v","isNil","isNaN","isPrimitive","has","isQuoted","s","startsWith","length","isQuotedWith","q","makeDataSourceName","driver","schema","extractDriverAndConnectorName","id","split","Object","freeze","$col","name","oorType","$expr","left","op","right","$f","args","$inc","field","increment","$dec","decrement","$dataSet","model","query","$sql","sql","$func","$increase","$decrease","$select","hasValueIn","arrayOfColl","key","find","coll","getValueFrom","l","i","value","undefined","mapFilterReducerArray","predicate","mapper","result","push","mapFilterReducerObject","mapFilter","collection","Array","isArray","reduce"],"mappings":";;;;AAAA,MAAM;AAAEA,EAAAA;AAAF,IAAQC,OAAO,CAAC,YAAD,CAArB;;AAEA,MAAMC,gBAAgB,GAAG,CAAC,OAAD,EAAU,SAAV,EAAqB,UAArB,CAAzB;AACA,MAAMC,gBAAgB,GAAG,IAAIC,GAAJ,CAAQ,CAC7B,QAD6B,EAE7B,SAF6B,EAG7B,QAH6B,EAI7B,QAJ6B,EAK7B,WAL6B,CAAR,CAAzB;;AAeA,SAASC,cAAT,CAAwBC,UAAxB,EAAoCC,UAApC,EAAgDC,QAAQ,GAAG,MAA3D,EAAmE;AAC/D,MAAIR,CAAC,CAACS,OAAF,CAAUH,UAAV,CAAJ,EAA2B;AACvB,WAAOC,UAAP;AACH;;AAED,MAAIP,CAAC,CAACS,OAAF,CAAUF,UAAV,CAAJ,EAA2B;AACvB,WAAOD,UAAP;AACH;;AAED,SAAO;AAAE,KAACE,QAAD,GAAY,CAACF,UAAD,EAAaC,UAAb;AAAd,GAAP;AACH;;AAEDG,OAAO,CAACC,SAAR,GAAqBC,CAAD,IAAOZ,CAAC,CAACa,KAAF,CAAQD,CAAR,KAAcZ,CAAC,CAACc,KAAF,CAAQF,CAAR,CAAzC;;AACAF,OAAO,CAACK,WAAR,GAAuBH,CAAD,IAAOT,gBAAgB,CAACa,GAAjB,CAAqB,OAAOJ,CAA5B,CAA7B;;AACAF,OAAO,CAACO,QAAR,GAAoBC,CAAD,IACf,CAACA,CAAC,CAACC,UAAF,CAAa,GAAb,KAAqBD,CAAC,CAACC,UAAF,CAAa,GAAb,CAAtB,KAA4CD,CAAC,CAAC,CAAD,CAAD,KAASA,CAAC,CAACA,CAAC,CAACE,MAAF,GAAW,CAAZ,CAD1D;;AAEAV,OAAO,CAACW,YAAR,GAAuB,CAACH,CAAD,EAAII,CAAJ,KAAUJ,CAAC,CAACC,UAAF,CAAaG,CAAb,KAAmBJ,CAAC,CAAC,CAAD,CAAD,KAASA,CAAC,CAACA,CAAC,CAACE,MAAF,GAAW,CAAZ,CAA9D;;AACAV,OAAO,CAACa,kBAAR,GAA6B,CAACC,MAAD,EAASC,MAAT,KAAoBD,MAAM,GAAG,GAAT,GAAeC,MAAhE;;AACAf,OAAO,CAACgB,6BAAR,GAAyCC,EAAD,IAAQA,EAAE,CAACC,KAAH,CAAS,GAAT,CAAhD;;AACAlB,OAAO,CAACL,cAAR,GAAyBA,cAAzB;AACAK,OAAO,CAACR,gBAAR,GAA2B2B,MAAM,CAACC,MAAP,CAAc5B,gBAAd,CAA3B;;AAEA,MAAM6B,IAAI,GAAIC,IAAD,KAAW;AAAEC,EAAAA,OAAO,EAAE,iBAAX;AAA8BD,EAAAA;AAA9B,CAAX,CAAb;;AACA,MAAME,KAAK,GAAG,CAACC,IAAD,EAAOC,EAAP,EAAWC,KAAX,MAAsB;AAChCJ,EAAAA,OAAO,EAAE,kBADuB;AAEhCE,EAAAA,IAFgC;AAGhCC,EAAAA,EAHgC;AAIhCC,EAAAA;AAJgC,CAAtB,CAAd;;AAMA,MAAMC,EAAE,GAAG,CAACN,IAAD,EAAO,GAAGO,IAAV,MAAoB;AAAEN,EAAAA,OAAO,EAAE,UAAX;AAAuBD,EAAAA,IAAvB;AAA6BO,EAAAA;AAA7B,CAApB,CAAX;;AACA,MAAMC,IAAI,GAAG,CAACC,KAAD,EAAQC,SAAR,KAAsBR,KAAK,CAACH,IAAI,CAACU,KAAD,CAAL,EAAc,GAAd,EAAmBC,SAAnB,CAAxC;;AACA,MAAMC,IAAI,GAAG,CAACF,KAAD,EAAQG,SAAR,KAAsBV,KAAK,CAACH,IAAI,CAACU,KAAD,CAAL,EAAc,GAAd,EAAmBG,SAAnB,CAAxC;;AACA,MAAMC,QAAQ,GAAG,CAACC,KAAD,EAAQC,KAAR,MAAmB;AAAEd,EAAAA,OAAO,EAAE,SAAX;AAAsBa,EAAAA,KAAtB;AAA6BC,EAAAA;AAA7B,CAAnB,CAAjB;;AACA,MAAMC,IAAI,GAAIC,GAAD,KAAU;AAAEhB,EAAAA,OAAO,EAAE,KAAX;AAAkBgB,EAAAA;AAAlB,CAAV,CAAb;;AAEAvC,OAAO,CAACqB,IAAR,GAAeA,IAAf;AACArB,OAAO,CAACwB,KAAR,GAAgBA,KAAhB;AACAxB,OAAO,CAAC4B,EAAR,GAAaA,EAAb;AACA5B,OAAO,CAACwC,KAAR,GAAgBZ,EAAhB;AACA5B,OAAO,CAAC8B,IAAR,GAAeA,IAAf;AACA9B,OAAO,CAACiC,IAAR,GAAeA,IAAf;AACAjC,OAAO,CAACyC,SAAR,GAAoBX,IAApB;AACA9B,OAAO,CAAC0C,SAAR,GAAoBT,IAApB;AACAjC,OAAO,CAACmC,QAAR,GAAmBA,QAAnB;AACAnC,OAAO,CAAC2C,OAAR,GAAkBR,QAAlB;AACAnC,OAAO,CAACsC,IAAR,GAAeA,IAAf;;AAEAtC,OAAO,CAAC4C,UAAR,GAAqB,CAACC,WAAD,EAAcC,GAAd,KACjBxD,CAAC,CAACyD,IAAF,CAAOF,WAAP,EAAqBG,IAAD,IAAUA,IAAI,CAACF,GAAD,CAAJ,IAAa,IAA3C,CADJ;;AAEA9C,OAAO,CAACiD,YAAR,GAAuB,CAACJ,WAAD,EAAcC,GAAd,KAAsB;AACzC,QAAMI,CAAC,GAAGL,WAAW,CAACnC,MAAtB;;AACA,OAAK,IAAIyC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,CAApB,EAAuBC,CAAC,EAAxB,EAA4B;AACxB,UAAMH,IAAI,GAAGH,WAAW,CAACM,CAAD,CAAxB;AACA,UAAMC,KAAK,GAAGJ,IAAI,IAAIA,IAAI,CAACF,GAAD,CAA1B;AACA,QAAIM,KAAK,IAAI,IAAb,EAAmB,OAAOA,KAAP;AACtB;;AACD,SAAOC,SAAP;AACH,CARD;;AAUA,MAAMC,qBAAqB,GAAG,CAACC,SAAD,EAAYC,MAAZ,KAAuB,CAACC,MAAD,EAASL,KAAT,KAAmB;AACpE,MAAIG,SAAS,CAACH,KAAD,CAAb,EAAsB;AAClBK,IAAAA,MAAM,CAACC,IAAP,CAAYF,MAAM,CAACJ,KAAD,CAAlB;AACH;;AACD,SAAOK,MAAP;AACH,CALD;;AAOA,MAAME,sBAAsB,GAAG,CAACJ,SAAD,EAAYC,MAAZ,KAAuB,CAACC,MAAD,EAASL,KAAT,EAAgBN,GAAhB,KAAwB;AAC1E,MAAIS,SAAS,CAACH,KAAD,CAAb,EAAsB;AAClBK,IAAAA,MAAM,CAACX,GAAD,CAAN,GAAcU,MAAM,CAACJ,KAAD,CAApB;AACH;;AACD,SAAOK,MAAP;AACH,CALD;;AAYAzD,OAAO,CAAC4D,SAAR,GAAoB,CAACC,UAAD,EAAaN,SAAb,EAAwBC,MAAxB,KAChBM,KAAK,CAACC,OAAN,CAAcF,UAAd,IACMvE,CAAC,CAAC0E,MAAF,CAASH,UAAT,EAAqBP,qBAAqB,CAACC,SAAD,EAAYC,MAAZ,CAA1C,EAA+D,EAA/D,CADN,GAEMlE,CAAC,CAAC0E,MAAF,CAASH,UAAT,EAAqBF,sBAAsB,CAACJ,SAAD,EAAYC,MAAZ,CAA3C,EAAgE,EAAhE,CAHV","sourcesContent":["const { _ } = require('@genx/july');\n\nconst SupportedDrivers = ['mysql', 'mongodb', 'rabbitmq'];\nconst JsPrimitiveTypes = new Set([\n    'number',\n    'boolean',\n    'string',\n    'symbol',\n    'undefined',\n]);\n\n/**\n * Merge two query conditions using given operator.\n * @param {*} condition1\n * @param {*} condition2\n * @param {*} operator\n * @returns {object}\n */\nfunction mergeCondition(condition1, condition2, operator = '$and') {\n    if (_.isEmpty(condition1)) {\n        return condition2;\n    }\n\n    if (_.isEmpty(condition2)) {\n        return condition1;\n    }\n\n    return { [operator]: [condition1, condition2] };\n}\n\nexports.isNothing = (v) => _.isNil(v) || _.isNaN(v);\nexports.isPrimitive = (v) => JsPrimitiveTypes.has(typeof v);\nexports.isQuoted = (s) =>\n    (s.startsWith(\"'\") || s.startsWith('\"')) && s[0] === s[s.length - 1];\nexports.isQuotedWith = (s, q) => s.startsWith(q) && s[0] === s[s.length - 1];\nexports.makeDataSourceName = (driver, schema) => driver + '.' + schema;\nexports.extractDriverAndConnectorName = (id) => id.split('.');\nexports.mergeCondition = mergeCondition;\nexports.SupportedDrivers = Object.freeze(SupportedDrivers);\n\nconst $col = (name) => ({ oorType: 'ColumnReference', name });\nconst $expr = (left, op, right) => ({\n    oorType: 'BinaryExpression',\n    left,\n    op,\n    right,\n});\nconst $f = (name, ...args) => ({ oorType: 'Function', name, args });\nconst $inc = (field, increment) => $expr($col(field), '+', increment);\nconst $dec = (field, decrement) => $expr($col(field), '-', decrement);\nconst $dataSet = (model, query) => ({ oorType: 'DataSet', model, query });\nconst $sql = (sql) => ({ oorType: 'SQL', sql });\n\nexports.$col = $col;\nexports.$expr = $expr;\nexports.$f = $f;\nexports.$func = $f;\nexports.$inc = $inc;\nexports.$dec = $dec;\nexports.$increase = $inc;\nexports.$decrease = $dec;\nexports.$dataSet = $dataSet;\nexports.$select = $dataSet;\nexports.$sql = $sql;\n\nexports.hasValueIn = (arrayOfColl, key) =>\n    _.find(arrayOfColl, (coll) => coll[key] != null);\nexports.getValueFrom = (arrayOfColl, key) => {\n    const l = arrayOfColl.length;\n    for (let i = 0; i < l; i++) {\n        const coll = arrayOfColl[i];\n        const value = coll && coll[key];\n        if (value != null) return value;\n    }\n    return undefined;\n};\n\nconst mapFilterReducerArray = (predicate, mapper) => (result, value) => {\n    if (predicate(value)) {\n        result.push(mapper(value));\n    }\n    return result;\n};\n\nconst mapFilterReducerObject = (predicate, mapper) => (result, value, key) => {\n    if (predicate(value)) {\n        result[key] = mapper(value);\n    }\n    return result;\n};\n\n/**\n * @param {object} collection\n * @param {function} predicate\n * @param {function} mapper\n */\nexports.mapFilter = (collection, predicate, mapper) =>\n    Array.isArray(collection)\n        ? _.reduce(collection, mapFilterReducerArray(predicate, mapper), [])\n        : _.reduce(collection, mapFilterReducerObject(predicate, mapper), {});\n"],"file":"lang.js"}