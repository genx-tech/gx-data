"use strict";require("source-map-support/register");const{fs,Promise}=require("rk-utils");const{tryRequire}=require("./lib");module.exports=async(csvFile,options,transformer)=>{const parse=tryRequire("csv-parse");const output=[];const readStream=fs.createReadStream(csvFile);const parser=parse({columns:true,...options});const read=transformer?()=>{let record;while(record=parser.read()){let transformed=transformer(record);if(transformed)output.push(transformed)}}:()=>{let record;while(record=parser.read()){output.push(record)}};return new Promise((resolve,reject)=>{parser.on("readable",read);parser.on("error",err=>{reject(err)});parser.on("end",()=>resolve(output));readStream.pipe(parser)})};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9wYXJzZUNzdkZpbGUuanMiXSwibmFtZXMiOlsiZnMiLCJQcm9taXNlIiwicmVxdWlyZSIsInRyeVJlcXVpcmUiLCJtb2R1bGUiLCJleHBvcnRzIiwiY3N2RmlsZSIsIm9wdGlvbnMiLCJ0cmFuc2Zvcm1lciIsInBhcnNlIiwib3V0cHV0IiwicmVhZFN0cmVhbSIsImNyZWF0ZVJlYWRTdHJlYW0iLCJwYXJzZXIiLCJjb2x1bW5zIiwicmVhZCIsInJlY29yZCIsInRyYW5zZm9ybWVkIiwicHVzaCIsInJlc29sdmUiLCJyZWplY3QiLCJvbiIsImVyciIsInBpcGUiXSwibWFwcGluZ3MiOiJvREFBQSxLQUFNLENBQUVBLEVBQUYsQ0FBTUMsT0FBTixFQUFrQkMsT0FBTyxDQUFDLFVBQUQsQ0FBL0IsQ0FDQSxLQUFNLENBQUVDLFVBQUYsRUFBaUJELE9BQU8sQ0FBQyxPQUFELENBQTlCLENBRUFFLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixNQUFPQyxPQUFQLENBQWdCQyxPQUFoQixDQUF5QkMsV0FBekIsR0FBeUMsQ0FDdEQsS0FBTUMsQ0FBQUEsS0FBSyxDQUFHTixVQUFVLENBQUMsV0FBRCxDQUF4QixDQUVBLEtBQU1PLENBQUFBLE1BQU0sQ0FBRyxFQUFmLENBRUEsS0FBTUMsQ0FBQUEsVUFBVSxDQUFHWCxFQUFFLENBQUNZLGdCQUFILENBQW9CTixPQUFwQixDQUFuQixDQUNBLEtBQU1PLENBQUFBLE1BQU0sQ0FBR0osS0FBSyxDQUFDLENBQ2pCSyxPQUFPLENBQUUsSUFEUSxDQUVqQixHQUFHUCxPQUZjLENBQUQsQ0FBcEIsQ0FLQSxLQUFNUSxDQUFBQSxJQUFJLENBQUdQLFdBQVcsQ0FBRyxJQUFNLENBQzdCLEdBQUlRLENBQUFBLE1BQUosQ0FDQSxNQUFPQSxNQUFNLENBQUdILE1BQU0sQ0FBQ0UsSUFBUCxFQUFoQixDQUErQixDQUMzQixHQUFJRSxDQUFBQSxXQUFXLENBQUdULFdBQVcsQ0FBQ1EsTUFBRCxDQUE3QixDQUNBLEdBQUlDLFdBQUosQ0FBaUJQLE1BQU0sQ0FBQ1EsSUFBUCxDQUFZRCxXQUFaLENBQ3BCLENBQ0osQ0FOdUIsQ0FNcEIsSUFBTSxDQUNOLEdBQUlELENBQUFBLE1BQUosQ0FDQSxNQUFPQSxNQUFNLENBQUdILE1BQU0sQ0FBQ0UsSUFBUCxFQUFoQixDQUErQixDQUMzQkwsTUFBTSxDQUFDUSxJQUFQLENBQVlGLE1BQVosQ0FDSCxDQUNKLENBWEQsQ0FhQSxNQUFPLElBQUlmLENBQUFBLE9BQUosQ0FBWSxDQUFDa0IsT0FBRCxDQUFVQyxNQUFWLEdBQXFCLENBQ3BDUCxNQUFNLENBQUNRLEVBQVAsQ0FBVSxVQUFWLENBQXNCTixJQUF0QixFQUdBRixNQUFNLENBQUNRLEVBQVAsQ0FBVSxPQUFWLENBQW1CQyxHQUFHLEVBQUksQ0FDdEJGLE1BQU0sQ0FBQ0UsR0FBRCxDQUNULENBRkQsRUFLQVQsTUFBTSxDQUFDUSxFQUFQLENBQVUsS0FBVixDQUFpQixJQUFNRixPQUFPLENBQUNULE1BQUQsQ0FBOUIsRUFFQUMsVUFBVSxDQUFDWSxJQUFYLENBQWdCVixNQUFoQixDQUNILENBWk0sQ0FhVixDQXJDRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgZnMsIFByb21pc2UgfSA9IHJlcXVpcmUoJ3JrLXV0aWxzJyk7XG5jb25zdCB7IHRyeVJlcXVpcmUgfSA9IHJlcXVpcmUoJy4vbGliJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKGNzdkZpbGUsIG9wdGlvbnMsIHRyYW5zZm9ybWVyKSA9PiB7XG4gICAgY29uc3QgcGFyc2UgPSB0cnlSZXF1aXJlKCdjc3YtcGFyc2UnKTtcblxuICAgIGNvbnN0IG91dHB1dCA9IFtdXG5cbiAgICBjb25zdCByZWFkU3RyZWFtID0gZnMuY3JlYXRlUmVhZFN0cmVhbShjc3ZGaWxlKTtcbiAgICBjb25zdCBwYXJzZXIgPSBwYXJzZSh7XG4gICAgICAgIGNvbHVtbnM6IHRydWUsXG4gICAgICAgIC4uLm9wdGlvbnNcbiAgICB9KTtcblxuICAgIGNvbnN0IHJlYWQgPSB0cmFuc2Zvcm1lciA/ICgpID0+IHtcbiAgICAgICAgbGV0IHJlY29yZDtcbiAgICAgICAgd2hpbGUgKHJlY29yZCA9IHBhcnNlci5yZWFkKCkpIHtcbiAgICAgICAgICAgIGxldCB0cmFuc2Zvcm1lZCA9IHRyYW5zZm9ybWVyKHJlY29yZCk7XG4gICAgICAgICAgICBpZiAodHJhbnNmb3JtZWQpIG91dHB1dC5wdXNoKHRyYW5zZm9ybWVkKTtcbiAgICAgICAgfVxuICAgIH0gOiAoKSA9PiB7XG4gICAgICAgIGxldCByZWNvcmQ7XG4gICAgICAgIHdoaWxlIChyZWNvcmQgPSBwYXJzZXIucmVhZCgpKSB7XG4gICAgICAgICAgICBvdXRwdXQucHVzaChyZWNvcmQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHBhcnNlci5vbigncmVhZGFibGUnLCByZWFkKTtcblxuICAgICAgICAvLyBDYXRjaCBhbnkgZXJyb3JcbiAgICAgICAgcGFyc2VyLm9uKCdlcnJvcicsIGVyciA9PiB7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gV2hlbiB3ZSBhcmUgZG9uZSwgdGVzdCB0aGF0IHRoZSBwYXJzZWQgb3V0cHV0IG1hdGNoZWQgd2hhdCBleHBlY3RlZFxuICAgICAgICBwYXJzZXIub24oJ2VuZCcsICgpID0+IHJlc29sdmUob3V0cHV0KSk7XG5cbiAgICAgICAgcmVhZFN0cmVhbS5waXBlKHBhcnNlcik7XG4gICAgfSk7ICAgIFxufTtcbiAgICAiXX0=