{"version":3,"file":"parseCsvFile.js","names":["fs","tryRequire","require","module","exports","csvFile","options","transformer","csv","readStream","createReadStream","parser","parse","headers","trim","transformWithCallback","output","line","data","callback","then","result","catch","error","Promise","resolve","reject","pipe","on","record","push","transform","row"],"sources":["../../src/utils/parseCsvFile.js"],"sourcesContent":["const { fs, tryRequire } = require('@genx/sys');\n\nmodule.exports = async (csvFile, options, transformer) => {\n    const csv = tryRequire('fast-csv');\n\n    const readStream = fs.createReadStream(csvFile);\n    const parser = csv.parse({\n        headers: true,\n        trim: true,\n        ...options,\n    });\n\n    let transformWithCallback, output;\n\n    if (transformer) {\n        let line = 0;\n        transformWithCallback = (data, callback) =>\n            transformer(data, line++)\n                .then((result) => callback(null, result))\n                .catch((error) => callback(error));\n    } else {\n        output = [];\n    }\n\n    return new Promise((resolve, reject) => {\n        if (!transformWithCallback) {\n            readStream.pipe(\n                parser\n                    .on('error', reject)\n                    .on('data', (record) => output.push(record))\n                    .on('end', () => resolve(output))\n            );\n        } else {\n            readStream.pipe(\n                parser\n                    .transform(transformWithCallback)\n                    .on('error', reject)\n                    .on('data', (row) => {})\n                    .on('end', () => resolve())\n            );\n        }\n    });\n};\n"],"mappings":";;;AAAA,MAAM;EAAEA,EAAE;EAAEC;AAAW,CAAC,GAAGC,OAAO,CAAC,WAAW,CAAC;AAE/CC,MAAM,CAACC,OAAO,GAAG,OAAOC,OAAO,EAAEC,OAAO,EAAEC,WAAW,KAAK;EACtD,MAAMC,GAAG,GAAGP,UAAU,CAAC,UAAU,CAAC;EAElC,MAAMQ,UAAU,GAAGT,EAAE,CAACU,gBAAgB,CAACL,OAAO,CAAC;EAC/C,MAAMM,MAAM,GAAGH,GAAG,CAACI,KAAK,CAAC;IACrBC,OAAO,EAAE,IAAI;IACbC,IAAI,EAAE,IAAI;IACV,GAAGR;EACP,CAAC,CAAC;EAEF,IAAIS,qBAAqB,EAAEC,MAAM;EAEjC,IAAIT,WAAW,EAAE;IACb,IAAIU,IAAI,GAAG,CAAC;IACZF,qBAAqB,GAAGA,CAACG,IAAI,EAAEC,QAAQ,KACnCZ,WAAW,CAACW,IAAI,EAAED,IAAI,EAAE,CAAC,CACpBG,IAAI,CAAEC,MAAM,IAAKF,QAAQ,CAAC,IAAI,EAAEE,MAAM,CAAC,CAAC,CACxCC,KAAK,CAAEC,KAAK,IAAKJ,QAAQ,CAACI,KAAK,CAAC,CAAC;EAC9C,CAAC,MAAM;IACHP,MAAM,GAAG,EAAE;EACf;EAEA,OAAO,IAAIQ,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACpC,IAAI,CAACX,qBAAqB,EAAE;MACxBN,UAAU,CAACkB,IAAI,CACXhB,MAAM,CACDiB,EAAE,CAAC,OAAO,EAAEF,MAAM,CAAC,CACnBE,EAAE,CAAC,MAAM,EAAGC,MAAM,IAAKb,MAAM,CAACc,IAAI,CAACD,MAAM,CAAC,CAAC,CAC3CD,EAAE,CAAC,KAAK,EAAE,MAAMH,OAAO,CAACT,MAAM,CAAC,CAAC,CACxC;IACL,CAAC,MAAM;MACHP,UAAU,CAACkB,IAAI,CACXhB,MAAM,CACDoB,SAAS,CAAChB,qBAAqB,CAAC,CAChCa,EAAE,CAAC,OAAO,EAAEF,MAAM,CAAC,CACnBE,EAAE,CAAC,MAAM,EAAGI,GAAG,IAAK,CAAC,CAAC,CAAC,CACvBJ,EAAE,CAAC,KAAK,EAAE,MAAMH,OAAO,EAAE,CAAC,CAClC;IACL;EACJ,CAAC,CAAC;AACN,CAAC"}