{"version":3,"file":"text.js","names":["Convertors","require","randomstring","_","ValidationError","any","module","exports","name","alias","sanitize","value","info","i18n","skipTypeCast","toText","noTrim","emptyAsNull","isNil","fixedLength","length","feild","maxLength","minLength","defaultValue","generate","randOpt","allowedChars","charset","caps","capitalization","serialize","qualifiers","concat"],"sources":["../../src/types/text.js"],"sourcesContent":["const Convertors = require('../Convertors');\nconst randomstring = require('randomstring');\nconst { _ } = require('@genx/july');\nconst { ValidationError } = require('../utils/Errors');\nconst any = require('./any');\n\nmodule.exports = {\n    name: 'text',\n\n    alias: ['string', 'char'],\n\n    sanitize: (value, info, i18n) => {\n        if (value == null) return null;\n\n        if (!info || !info.skipTypeCast) {\n            value = Convertors.toText(value, info && info.noTrim);\n        }\n\n        if (value === '' && info.emptyAsNull) {\n            return null;\n        }\n\n        if (!_.isNil(value)) {\n            if (info && info.fixedLength && value.length !== info.fixedLength) {\n                throw new ValidationError(\n                    `The length of the ${\n                        info.name || 'text'\n                    } value is not correct (expected: ${\n                        info.fixedLength\n                    }, actual: ${value.length}).`,\n                    { value, feild: info }\n                );\n            }\n\n            if (info && info.maxLength && value.length > info.maxLength) {\n                throw new ValidationError(\n                    `The length of the ${\n                        info.name || 'text'\n                    } value exceeds max limit (maximum: ${\n                        info.maxLength\n                    }, actual: ${value.length}).`,\n                    { value, feild: info }\n                );\n            }\n\n            if (info && info.minLength && value.length < info.minLength) {\n                throw new ValidationError(\n                    `The length of the ${\n                        info.name || 'text'\n                    } value does not reach min requirement (minimum: ${\n                        info.minLength\n                    }, actual: ${value.length}).`,\n                    { value, feild: info }\n                );\n            }\n        }\n\n        return value;\n    },\n\n    defaultValue: '',\n\n    generate: (info, i18n) => {\n        const randOpt = {};\n\n        if (info.fixedLength) {\n            randOpt.length = info.fixedLength;\n        }\n\n        if (info.maxLength) {\n            randOpt.length = info.maxLength > 32 ? 32 : info.maxLength;\n        }\n\n        if (info.allowedChars) {\n            randOpt.charset = info.allowedChars;\n        }\n\n        if (info.caps) {\n            randOpt.capitalization = info.caps;\n        }\n\n        return randomstring.generate(randOpt);\n    },\n\n    serialize: (value) => value,\n\n    qualifiers: any.qualifiers.concat([\n        'fixedLength',\n        'maxLength',\n        'encoding',\n        'allowedChars',\n        'caps',\n        'noTrim',\n        'emptyAsNull',\n    ]),\n};\n"],"mappings":"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"}