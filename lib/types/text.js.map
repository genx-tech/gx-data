{"version":3,"sources":["../../src/types/text.js"],"names":["Convertors","require","randomstring","_","ValidationError","any","module","exports","name","alias","sanitize","value","info","i18n","skipTypeCast","toText","noTrim","emptyAsNull","isNil","fixedLength","length","feild","maxLength","minLength","defaultValue","generate","randOpt","allowedChars","charset","caps","capitalization","serialize","qualifiers","concat"],"mappings":"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","sourcesContent":["const Convertors = require('../Convertors');\nconst randomstring = require('randomstring');\nconst { _ } = require('@genx/july');\nconst { ValidationError } = require('../utils/Errors');\nconst any = require('./any');\n\nmodule.exports = {\n    name: 'text',\n\n    alias: ['string', 'char'],\n\n    sanitize: (value, info, i18n) => {\n        if (value == null) return null;\n\n        if (!info || !info.skipTypeCast) {\n            value = Convertors.toText(value, info && info.noTrim);\n        }\n\n        if (value === '' && info.emptyAsNull) {\n            return null;\n        }\n\n        if (!_.isNil(value)) {\n            if (info && info.fixedLength && value.length !== info.fixedLength) {\n                throw new ValidationError(\n                    `The length of the ${\n                        info.name || 'text'\n                    } value is not correct (expected: ${\n                        info.fixedLength\n                    }, actual: ${value.length}).`,\n                    { value, feild: info }\n                );\n            }\n\n            if (info && info.maxLength && value.length > info.maxLength) {\n                throw new ValidationError(\n                    `The length of the ${\n                        info.name || 'text'\n                    } value exceeds max limit (maximum: ${\n                        info.maxLength\n                    }, actual: ${value.length}).`,\n                    { value, feild: info }\n                );\n            }\n\n            if (info && info.minLength && value.length < info.minLength) {\n                throw new ValidationError(\n                    `The length of the ${\n                        info.name || 'text'\n                    } value does not reach min requirement (minimum: ${\n                        info.minLength\n                    }, actual: ${value.length}).`,\n                    { value, feild: info }\n                );\n            }\n        }\n\n        return value;\n    },\n\n    defaultValue: '',\n\n    generate: (info, i18n) => {\n        const randOpt = {};\n\n        if (info.fixedLength) {\n            randOpt.length = info.fixedLength;\n        }\n\n        if (info.maxLength) {\n            randOpt.length = info.maxLength > 32 ? 32 : info.maxLength;\n        }\n\n        if (info.allowedChars) {\n            randOpt.charset = info.allowedChars;\n        }\n\n        if (info.caps) {\n            randOpt.capitalization = info.caps;\n        }\n\n        return randomstring.generate(randOpt);\n    },\n\n    serialize: (value) => value,\n\n    qualifiers: any.qualifiers.concat([\n        'fixedLength',\n        'maxLength',\n        'encoding',\n        'allowedChars',\n        'caps',\n        'noTrim',\n        'emptyAsNull',\n    ]),\n};\n"],"file":"text.js"}