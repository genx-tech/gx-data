{"version":3,"file":"datetime.js","names":["DateTime","require","any","ValidationError","module","exports","name","typeObject","alias","sanitize","value","info","i18n","opts","zone","timezone","raw","Date","fromJSDate","type","dontParse","inputFormat","fromFormat","fromISO","fromMillis","isLuxonDateTime","field","isValid","defaultValue","generate","now","local","serialize","toISO","includeOffset","qualifiers","concat"],"sources":["../../src/types/datetime.js"],"sourcesContent":["const { DateTime } = require('luxon');\nconst any = require('./any');\nconst { ValidationError } = require('../utils/Errors');\n\nmodule.exports = {\n    name: 'datetime',\n\n    typeObject: DateTime,\n\n    alias: ['date', 'time', 'timestamp'],\n\n    sanitize: (value, info, i18n) => {\n        if (value == null) return null;\n\n        const opts = { zone: i18n?.timezone || 'local' };\n\n        const raw = value;\n\n        if (value instanceof Date) {\n            value = DateTime.fromJSDate(value, opts);\n        } else {\n            const type = typeof value;\n\n            if (type === 'string' && !info.dontParse) {\n                if (info.inputFormat) {\n                    value = DateTime.fromFormat(value, info.inputFormat, opts);\n                } else {\n                    value = DateTime.fromISO(value, opts);\n                }\n            } else if (type === 'number') {\n                value = DateTime.fromMillis(value, opts);\n            } else if (type !== 'object' || !value.isLuxonDateTime) {\n                throw new ValidationError('Invalid datetime object.', {\n                    value: raw,\n                    field: info,\n                });\n            }\n        }\n\n        if (!value.isValid) {\n            throw new ValidationError('Invalid datetime object.', {\n                value: raw,\n                field: info,\n            });\n        }\n\n        return value;\n    },\n\n    defaultValue: 0,\n\n    generate: (info, i18n) => (i18n ? i18n.now() : DateTime.local()),\n\n    serialize: (value) => {\n        if (value && value.toISO) {\n            return value.toISO({ includeOffset: false });\n        }\n\n        return value;\n    },\n\n    qualifiers: any.qualifiers.concat([\n        'timezone',\n        'dateOnly',\n        'timeOnly',\n        'inputFormat',\n        'dontParse',\n    ]),\n};\n"],"mappings":";;;;AAAA,MAAM;EAAEA;AAAF,IAAeC,OAAO,CAAC,OAAD,CAA5B;;AACA,MAAMC,GAAG,GAAGD,OAAO,CAAC,OAAD,CAAnB;;AACA,MAAM;EAAEE;AAAF,IAAsBF,OAAO,CAAC,iBAAD,CAAnC;;AAEAG,MAAM,CAACC,OAAP,GAAiB;EACbC,IAAI,EAAE,UADO;EAGbC,UAAU,EAAEP,QAHC;EAKbQ,KAAK,EAAE,CAAC,MAAD,EAAS,MAAT,EAAiB,WAAjB,CALM;EAObC,QAAQ,EAAE,CAACC,KAAD,EAAQC,IAAR,EAAcC,IAAd,KAAuB;IAC7B,IAAIF,KAAK,IAAI,IAAb,EAAmB,OAAO,IAAP;IAEnB,MAAMG,IAAI,GAAG;MAAEC,IAAI,EAAE,CAAAF,IAAI,QAAJ,YAAAA,IAAI,CAAEG,QAAN,KAAkB;IAA1B,CAAb;IAEA,MAAMC,GAAG,GAAGN,KAAZ;;IAEA,IAAIA,KAAK,YAAYO,IAArB,EAA2B;MACvBP,KAAK,GAAGV,QAAQ,CAACkB,UAAT,CAAoBR,KAApB,EAA2BG,IAA3B,CAAR;IACH,CAFD,MAEO;MACH,MAAMM,IAAI,GAAG,OAAOT,KAApB;;MAEA,IAAIS,IAAI,KAAK,QAAT,IAAqB,CAACR,IAAI,CAACS,SAA/B,EAA0C;QACtC,IAAIT,IAAI,CAACU,WAAT,EAAsB;UAClBX,KAAK,GAAGV,QAAQ,CAACsB,UAAT,CAAoBZ,KAApB,EAA2BC,IAAI,CAACU,WAAhC,EAA6CR,IAA7C,CAAR;QACH,CAFD,MAEO;UACHH,KAAK,GAAGV,QAAQ,CAACuB,OAAT,CAAiBb,KAAjB,EAAwBG,IAAxB,CAAR;QACH;MACJ,CAND,MAMO,IAAIM,IAAI,KAAK,QAAb,EAAuB;QAC1BT,KAAK,GAAGV,QAAQ,CAACwB,UAAT,CAAoBd,KAApB,EAA2BG,IAA3B,CAAR;MACH,CAFM,MAEA,IAAIM,IAAI,KAAK,QAAT,IAAqB,CAACT,KAAK,CAACe,eAAhC,EAAiD;QACpD,MAAM,IAAItB,eAAJ,CAAoB,0BAApB,EAAgD;UAClDO,KAAK,EAAEM,GAD2C;UAElDU,KAAK,EAAEf;QAF2C,CAAhD,CAAN;MAIH;IACJ;;IAED,IAAI,CAACD,KAAK,CAACiB,OAAX,EAAoB;MAChB,MAAM,IAAIxB,eAAJ,CAAoB,0BAApB,EAAgD;QAClDO,KAAK,EAAEM,GAD2C;QAElDU,KAAK,EAAEf;MAF2C,CAAhD,CAAN;IAIH;;IAED,OAAOD,KAAP;EACH,CA3CY;EA6CbkB,YAAY,EAAE,CA7CD;EA+CbC,QAAQ,EAAE,CAAClB,IAAD,EAAOC,IAAP,KAAiBA,IAAI,GAAGA,IAAI,CAACkB,GAAL,EAAH,GAAgB9B,QAAQ,CAAC+B,KAAT,EA/ClC;EAiDbC,SAAS,EAAGtB,KAAD,IAAW;IAClB,IAAIA,KAAK,IAAIA,KAAK,CAACuB,KAAnB,EAA0B;MACtB,OAAOvB,KAAK,CAACuB,KAAN,CAAY;QAAEC,aAAa,EAAE;MAAjB,CAAZ,CAAP;IACH;;IAED,OAAOxB,KAAP;EACH,CAvDY;EAyDbyB,UAAU,EAAEjC,GAAG,CAACiC,UAAJ,CAAeC,MAAf,CAAsB,CAC9B,UAD8B,EAE9B,UAF8B,EAG9B,UAH8B,EAI9B,aAJ8B,EAK9B,WAL8B,CAAtB;AAzDC,CAAjB"}