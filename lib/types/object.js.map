{"version":3,"sources":["../../src/types/object.js"],"names":["_","require","isNothing","ValidationError","any","jsonStarter","Set","jsonEnding","module","exports","name","alias","sanitize","value","info","i18n","prefix","raw","type","dontParse","length","has","JSON","parse","Array","isArray","toPlainObject","feild","schema","Validators","validateObjectBySchema","defaultValue","generate","serialize","stringify","qualifiers","concat"],"mappings":";;;;AAAA,MAAM;AAAEA,EAAAA;AAAF,IAAQC,OAAO,CAAC,YAAD,CAArB;;AACA,MAAM;AAAEC,EAAAA;AAAF,IAAgBD,OAAO,CAAC,eAAD,CAA7B;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAAsBF,OAAO,CAAC,iBAAD,CAAnC;;AACA,MAAMG,GAAG,GAAGH,OAAO,CAAC,OAAD,CAAnB;;AAEA,MAAMI,WAAW,GAAG,IAAIC,GAAJ,CAAQ,GAAR,EAAa,GAAb,EAAkB,GAAlB,CAApB;AACA,MAAMC,UAAU,GAAG;AACf,OAAK,GADU;AAEf,OAAK,GAFU;AAGf,OAAK;AAHU,CAAnB;AASAC,MAAM,CAACC,OAAP,GAAiB;AACbC,EAAAA,IAAI,EAAE,QADO;AAGbC,EAAAA,KAAK,EAAE,CAAC,MAAD,CAHM;AAKbC,EAAAA,QAAQ,EAAE,CAACC,KAAD,EAAQC,IAAR,EAAcC,IAAd,EAAoBC,MAApB,KAA+B;AACrC,QAAIH,KAAK,IAAI,IAAb,EAAmB,OAAO,IAAP;AAEnB,UAAMI,GAAG,GAAGJ,KAAZ;AACA,UAAMK,IAAI,GAAG,OAAOL,KAApB;;AAEA,YAAQK,IAAR;AACI,WAAK,QAAL;AACI,YACI,CAACJ,IAAI,CAACK,SAAN,IACAN,KAAK,CAACO,MAAN,GAAe,CADf,IAEAf,WAAW,CAACgB,GAAZ,CAAgBR,KAAK,CAAC,CAAD,CAArB,CAFA,IAGAN,UAAU,CAACM,KAAK,CAAC,CAAD,CAAN,CAAV,KAAyBA,KAAK,CAACA,KAAK,CAACO,MAAN,GAAe,CAAhB,CAJlC,EAKE;AACEP,UAAAA,KAAK,GAAGS,IAAI,CAACC,KAAL,CAAWV,KAAX,CAAR;AACH;;AACD;;AAEJ,WAAK,SAAL;AACA,WAAK,QAAL;AACA,WAAK,QAAL;AAEI;;AAEJ,WAAK,QAAL;AACI,YAAI,CAACW,KAAK,CAACC,OAAN,CAAcZ,KAAd,CAAL,EAA2B;AACvBA,UAAAA,KAAK,GAAGb,CAAC,CAAC0B,aAAF,CAAgBb,KAAhB,CAAR;AACH;;AACD;;AAEJ;AACI,cAAM,IAAIV,eAAJ,CAAoB,sBAApB,EAA4C;AAC9CU,UAAAA,KAAK,EAAEI,GADuC;AAE9CU,UAAAA,KAAK,EAAEb;AAFuC,SAA5C,CAAN;AAzBR;;AA+BA,QAAIA,IAAI,CAACc,MAAT,EAAiB;AACb,YAAMC,UAAU,GAAG5B,OAAO,CAAC,eAAD,CAA1B;;AACA,aAAO4B,UAAU,CAACC,sBAAX,CACHjB,KADG,EAEHC,IAAI,CAACc,MAFF,EAGHb,IAHG,EAIHC,MAJG,CAAP;AAMH;;AAED,WAAOH,KAAP;AACH,GArDY;AAuDbkB,EAAAA,YAAY,EAAE,EAvDD;AAyDbC,EAAAA,QAAQ,EAAE,CAAClB,IAAD,EAAOC,IAAP,MAAiB,EAAjB,CAzDG;AA2DbkB,EAAAA,SAAS,EAAGpB,KAAD,IAAYX,SAAS,CAACW,KAAD,CAAT,GAAmB,IAAnB,GAA0BS,IAAI,CAACY,SAAL,CAAerB,KAAf,CA3DpC;AA6DbsB,EAAAA,UAAU,EAAE/B,GAAG,CAAC+B,UAAJ,CAAeC,MAAf,CAAsB,CAAC,QAAD,CAAtB;AA7DC,CAAjB","sourcesContent":["const { _ } = require('@genx/july');\nconst { isNothing } = require('../utils/lang');\nconst { ValidationError } = require('../utils/Errors');\nconst any = require('./any');\n\nconst jsonStarter = new Set('\"', '[', '{');\nconst jsonEnding = {\n    '\"': '\"',\n    '[': ']',\n    '{': '}',\n};\n\n// info.dontParse\n// info.schema\n\nmodule.exports = {\n    name: 'object',\n\n    alias: ['json'],\n\n    sanitize: (value, info, i18n, prefix) => {\n        if (value == null) return null;\n\n        const raw = value;\n        const type = typeof value;\n\n        switch (type) {\n            case 'string':\n                if (\n                    !info.dontParse &&\n                    value.length > 0 &&\n                    jsonStarter.has(value[0]) &&\n                    jsonEnding[value[0]] === value[value.length - 1]\n                ) {\n                    value = JSON.parse(value);\n                }\n                break;\n\n            case 'boolean':\n            case 'number':\n            case 'bigint':\n                //skip, keep original value\n                break;\n\n            case 'object':\n                if (!Array.isArray(value)) {\n                    value = _.toPlainObject(value);\n                }\n                break;\n\n            default:\n                throw new ValidationError('Invalid object value', {\n                    value: raw,\n                    feild: info,\n                });\n        }\n\n        if (info.schema) {\n            const Validators = require('../Validators');\n            return Validators.validateObjectBySchema(\n                value,\n                info.schema,\n                i18n,\n                prefix\n            );\n        }\n\n        return value;\n    },\n\n    defaultValue: {},\n\n    generate: (info, i18n) => ({}),\n\n    serialize: (value) => (isNothing(value) ? null : JSON.stringify(value)),\n\n    qualifiers: any.qualifiers.concat(['schema']),\n};\n"],"file":"object.js"}