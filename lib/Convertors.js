"use strict";

require("source-map-support/register");

const validator = require("validator");

const {
  _
} = require("rk-utils");

const remap = require('./utils/remap');

exports.toBoolean = value => typeof value === "boolean" ? value : validator.toBoolean(value.toString(), true);

exports.toText = (value, noTrim) => {
  if (value) {
    value = typeof value !== "string" ? value.toString() : value;
    return noTrim ? value : value.trim();
  }

  return value;
};

exports.toInt = (value, radix) => _.isInteger(value) ? value : parseInt(value, radix);

exports.toFloat = value => _.isFinite(value) ? value : validator.toFloat(value);

exports.jsonToBase64 = obj => Buffer.from(JSON.stringify(obj)).toString("base64");

exports.base64ToJson = base64 => JSON.parse(Buffer.from(base64, "base64").toString("ascii"));

exports.toKVPairs = (arrayOfObjects, property, transformer) => {
  const keyGetter = typeof property === "function" ? property : obj => obj[property];
  return arrayOfObjects.reduce((table, obj) => {
    table[keyGetter(obj)] = transformer ? transformer(obj) : obj;
    return table;
  }, {});
};

exports.toSet = (arrayOfObjects, property) => {
  if (!arrayOfObjects) return new Set();
  const valueGetter = typeof property === "function" ? property : obj => obj[property];
  const result = new Set();
  arrayOfObjects.forEach(obj => result.add(valueGetter(obj)));
  return result;
};

const mapKeysDeep = (object, mapping, keepUnmapped) => {
  if (typeof mapping === "string") return {
    [mapping]: object
  };
  let newObj = {};

  _.forOwn(object, (v, k) => {
    if (k in mapping) {
      let nk = mapping[k];

      if (Array.isArray(nk)) {
        newObj[nk[0]] = { ...newObj[nk[0]],
          ...mapKeysDeep(v, nk[1], keepUnmapped)
        };
      } else {
        newObj[nk] = v;
      }
    } else {
      if (keepUnmapped) {
        newObj[k] = v;
      }
    }
  });

  return newObj;
};

const mapArraysDeep = (arrayOfObjects, mapping, keepUnmapped) => _.map(arrayOfObjects, obj => mapKeysDeep(obj, mapping, keepUnmapped));

exports.mapKeysDeep = mapKeysDeep;
exports.mapArraysDeep = mapArraysDeep;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Db252ZXJ0b3JzLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRvciIsInJlcXVpcmUiLCJfIiwicmVtYXAiLCJleHBvcnRzIiwidG9Cb29sZWFuIiwidmFsdWUiLCJ0b1N0cmluZyIsInRvVGV4dCIsIm5vVHJpbSIsInRyaW0iLCJ0b0ludCIsInJhZGl4IiwiaXNJbnRlZ2VyIiwicGFyc2VJbnQiLCJ0b0Zsb2F0IiwiaXNGaW5pdGUiLCJqc29uVG9CYXNlNjQiLCJvYmoiLCJCdWZmZXIiLCJmcm9tIiwiSlNPTiIsInN0cmluZ2lmeSIsImJhc2U2NFRvSnNvbiIsImJhc2U2NCIsInBhcnNlIiwidG9LVlBhaXJzIiwiYXJyYXlPZk9iamVjdHMiLCJwcm9wZXJ0eSIsInRyYW5zZm9ybWVyIiwia2V5R2V0dGVyIiwicmVkdWNlIiwidGFibGUiLCJ0b1NldCIsIlNldCIsInZhbHVlR2V0dGVyIiwicmVzdWx0IiwiZm9yRWFjaCIsImFkZCIsIm1hcEtleXNEZWVwIiwib2JqZWN0IiwibWFwcGluZyIsImtlZXBVbm1hcHBlZCIsIm5ld09iaiIsImZvck93biIsInYiLCJrIiwibmsiLCJBcnJheSIsImlzQXJyYXkiLCJtYXBBcnJheXNEZWVwIiwibWFwIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztBQUVBLE1BQU1BLFNBQVMsR0FBR0MsT0FBTyxDQUFDLFdBQUQsQ0FBekI7O0FBQ0EsTUFBTTtBQUFFQyxFQUFBQTtBQUFGLElBQVFELE9BQU8sQ0FBQyxVQUFELENBQXJCOztBQUNBLE1BQU1FLEtBQUssR0FBR0YsT0FBTyxDQUFDLGVBQUQsQ0FBckI7O0FBRUFHLE9BQU8sQ0FBQ0MsU0FBUixHQUFxQkMsS0FBRCxJQUFZLE9BQU9BLEtBQVAsS0FBaUIsU0FBakIsR0FBNkJBLEtBQTdCLEdBQXFDTixTQUFTLENBQUNLLFNBQVYsQ0FBb0JDLEtBQUssQ0FBQ0MsUUFBTixFQUFwQixFQUFzQyxJQUF0QyxDQUFyRTs7QUFFQUgsT0FBTyxDQUFDSSxNQUFSLEdBQWlCLENB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QUFHTixPQUFPLENBQUNLLENBQUQsQ0FBaEI7O0FBQ0EsVUFBSUUsS0FBSyxDQUFDQyxPQUFOLENBQWNGLEVBQWQsQ0FBSixFQUF1QjtBQUNuQkosUUFBQUEsTUFBTSxDQUFDSSxFQUFFLENBQUMsQ0FBRCxDQUFILENBQU4sR0FBZ0IsRUFBRSxHQUFHSixNQUFNLENBQUNJLEVBQUUsQ0FBQyxDQUFELENBQUgsQ0FBWDtBQUFvQixhQUFHUixXQUFXLENBQUNNLENBQUQsRUFBSUUsRUFBRSxDQUFDLENBQUQsQ0FBTixFQUFXTCxZQUFYO0FBQWxDLFNBQWhCO0FBQ0gsT0FGRCxNQUVPO0FBQ0hDLFFBQUFBLE1BQU0sQ0FBQ0ksRUFBRCxDQUFOLEdBQWFGLENBQWI7QUFDSDtBQUNKLEtBUEQsTUFPTztBQUNILFVBQUlILFlBQUosRUFBa0I7QUFDZEMsUUFBQUEsTUFBTSxDQUFDRyxDQUFELENBQU4sR0FBWUQsQ0FBWjtBQUNIO0FBQ0o7QUFDSixHQWJEOztBQWVBLFNBQU9GLE1BQVA7QUFDSCxDQXBCRDs7QUFzQkEsTUFBTU8sYUFBYSxHQUFHLENBQUN2QixjQUFELEVBQWlCYyxPQUFqQixFQUEwQkMsWUFBMUIsS0FDbEJ4QyxDQUFDLENBQUNpRCxHQUFGLENBQU14QixjQUFOLEVBQXVCVCxHQUFELElBQVNxQixXQUFXLENBQUNyQixHQUFELEVBQU11QixPQUFOLEVBQWVDLFlBQWYsQ0FBMUMsQ0FESjs7QUFHQXRDLE9BQU8sQ0FBQ21DLFdBQVIsR0FBc0JBLFdBQXRCO0FBQ0FuQyxPQUFPLENBQUM4QyxhQUFSLEdBQXdCQSxhQUF4QiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5jb25zdCB2YWxpZGF0b3IgPSByZXF1aXJlKFwidmFsaWRhdG9yXCIpO1xuY29uc3QgeyBfIH0gPSByZXF1aXJlKFwicmstdXRpbHNcIik7XG5jb25zdCByZW1hcCA9IHJlcXVpcmUoJy4vdXRpbHMvcmVtYXAnKTtcblxuZXhwb3J0cy50b0Jvb2xlYW4gPSAodmFsdWUpID0+ICh0eXBlb2YgdmFsdWUgPT09IFwiYm9vbGVhblwiID8gdmFsdWUgOiB2YWxpZGF0b3IudG9Cb29sZWFuKHZhbHVlLnRvU3RyaW5nKCksIHRydWUpKTtcblxuZXhwb3J0cy50b1RleHQgPSAodmFsdWUsIG5vVHJpbSkgPT4ge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgICB2YWx1ZSA9IHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIiA/IHZhbHVlLnRvU3RyaW5nKCkgOiB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIG5vVHJpbSA/IHZhbHVlIDogdmFsdWUudHJpbSgpO1xuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZTtcbn07XG5cbmV4cG9ydHMudG9JbnQgPSAodmFsdWUsIHJhZGl4KSA9PiAoXy5pc0ludGVnZXIodmFsdWUpID8gdmFsdWUgOiBwYXJzZUludCh2YWx1ZSwgcmFkaXgpKTtcblxuZXhwb3J0cy50b0Zsb2F0ID0gKHZhbHVlKSA9PiAoXy5pc0Zpbml0ZSh2YWx1ZSkgPyB2YWx1ZSA6IHZhbGlkYXRvci50b0Zsb2F0KHZhbHVlKSk7XG5cbmV4cG9ydHMuanNvblRvQmFzZTY0ID0gKG9iaikgPT4gQnVmZmVyLmZyb20oSlNPTi5zdHJpbmdpZnkob2JqKSkudG9TdHJpbmcoXCJiYXNlNjRcIik7XG5cbmV4cG9ydHMuYmFzZTY0VG9Kc29uID0gKGJhc2U2NCkgPT4gSlNPTi5wYXJzZShCdWZmZXIuZnJvbShiYXNlNjQsIFwiYmFzZTY0XCIpLnRvU3RyaW5nKFwiYXNjaWlcIikpO1xuXG5leHBvcnRzLnRvS1ZQYWlycyA9IChhcnJheU9mT2JqZWN0cywgcHJvcGVydHksIHRyYW5zZm9ybWVyKSA9PiB7XG4gICAgY29uc3Qga2V5R2V0dGVyID0gdHlwZW9mIHByb3BlcnR5ID09PSBcImZ1bmN0aW9uXCIgPyBwcm9wZXJ0eSA6IChvYmopID0+IG9ialtwcm9wZXJ0eV07XG5cbiAgICByZXR1cm4gYXJyYXlPZk9iamVjdHMucmVkdWNlKCh0YWJsZSwgb2JqKSA9PiB7XG4gICAgICAgIHRhYmxlW2tleUdldHRlcihvYmopXSA9IHRyYW5zZm9ybWVyID8gdHJhbnNmb3JtZXIob2JqKSA6IG9iajtcbiAgICAgICAgcmV0dXJuIHRhYmxlO1xuICAgIH0sIHt9KTtcbn07XG5cbmV4cG9ydHMudG9TZXQgPSAoYXJyYXlPZk9iamVjdHMsIHByb3BlcnR5KSA9PiB7XG4gICAgaWYgKCFhcnJheU9mT2JqZWN0cykgcmV0dXJuIG5ldyBTZXQoKTtcblxuICAgIGNvbnN0IHZhbHVlR2V0dGVyID0gdHlwZW9mIHByb3BlcnR5ID09PSBcImZ1bmN0aW9uXCIgPyBwcm9wZXJ0eSA6IChvYmopID0+IG9ialtwcm9wZXJ0eV07XG4gICAgY29uc3QgcmVzdWx0ICA9IG5ldyBTZXQoKTtcblxuICAgIGFycmF5T2ZPYmplY3RzLmZvckVhY2gob2JqID0+IHJlc3VsdC5hZGQodmFsdWVHZXR0ZXIob2JqKSkpO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBSZW1hcCB0aGUga2V5cyBvZiBvYmplY3QgZWxlbWVudHMgaW4gYW4gYXJyYXksIGxpa2UgcHJvamVjdGlvbi5cbiAqIEBwYXJhbSB7Kn0gb2JqZWN0XG4gKiBAcGFyYW0geyp9IG1hcHBpbmcgLSBrZXkgdG8gbmV3S2V5IG9yIGtleSB0byBhcnJheVsgbmV3S2V5LCB2YWx1ZU1hcCBdIGZvciBuZXh0IGxldmVsIG1hcHBpbmdcbiAqIEBwYXJhbSB7Ym9vbGVhbn0ga2VlcFVubWFwcGVkIC0gSWYgdHJ1ZSwgd2lsbCBrZWVwIHRob3NlIG5vdCBpbiBtYXBwaW5nIGFzIGl0cyBvcmlnaW5hbCBrZXksIG90aGVyd2lzZSBmaWx0ZXIgb3V0XG4gKi9cbmNvbnN0IG1hcEtleXNEZWVwID0gKG9iamVjdCwgbWFwcGluZywga2VlcFVubWFwcGVkKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBtYXBwaW5nID09PSBcInN0cmluZ1wiKSByZXR1cm4geyBbbWFwcGluZ106IG9iamVjdCB9O1xuXG4gICAgbGV0IG5ld09iaiA9IHt9O1xuICAgIF8uZm9yT3duKG9iamVjdCwgKHYsIGspID0+IHtcbiAgICAgICAgaWYgKGsgaW4gbWFwcGluZykge1xuICAgICAgICAgICAgbGV0IG5rID0gbWFwcGluZ1trXTtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG5rKSkge1xuICAgICAgICAgICAgICAgIG5ld09ialtua1swXV0gPSB7IC4uLm5ld09ialtua1swXV0sIC4uLm1hcEtleXNEZWVwKHYsIG5rWzFdLCBrZWVwVW5tYXBwZWQpIH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ld09ialtua10gPSB2O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGtlZXBVbm1hcHBlZCkge1xuICAgICAgICAgICAgICAgIG5ld09ialtrXSA9IHY7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBuZXdPYmo7XG59O1xuXG5jb25zdCBtYXBBcnJheXNEZWVwID0gKGFycmF5T2ZPYmplY3RzLCBtYXBwaW5nLCBrZWVwVW5tYXBwZWQpID0+XG4gICAgXy5tYXAoYXJyYXlPZk9iamVjdHMsIChvYmopID0+IG1hcEtleXNEZWVwKG9iaiwgbWFwcGluZywga2VlcFVubWFwcGVkKSk7XG5cbmV4cG9ydHMubWFwS2V5c0RlZXAgPSBtYXBLZXlzRGVlcDtcbmV4cG9ydHMubWFwQXJyYXlzRGVlcCA9IG1hcEFycmF5c0RlZXA7XG4iXX0=