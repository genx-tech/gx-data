"use strict";

require("source-map-support/register");

const {
  _,
  pascalCase,
  sleep_
} = require("rk-utils");

const retryFailed = error => [false, error];

const retryOK = result => [true, result];

const directReturn = a => a;

class DbModel {
  constructor(app, connector, i18n) {
    this.app = app;
    this.connector = connector;
    this.i18n = i18n;
    this._modelCache = {};
  }

  get driver() {
    return this.connector.driver;
  }

  model(entityName) {
    if (this._modelCache[entityName]) return this._modelCache[entityName];
    let modelClassName = pascalCase(entityName);
    if (this._modelCache[modelClassName]) return this._modelCache[modelClassName];
    let entityCustomClassFactory = this.loadCustomModel(modelClassName);
    let entityClassFactory = this.loadModel(modelClassName);

    let BaseEntityModel = require(`./drivers/${this.driver}/EntityModel`);

    if (entityCustomClassFactory) {
      BaseEntityModel = entityCustomClassFactory(BaseEntityModel);
    }

    const modelClass = entityClassFactory(BaseEntityModel);
    modelClass.db = this;

    if (modelClass.__init) {
      modelClass.__init();
    }

    this._modelCache[entityName] = modelClass;

    if (modelClassName !== entityName) {
      this._modelCache[modelClassName] = modelClass;
    }

    return modelClass;
  }

  entitiesOfType(baseEntityName) {
    return _.filter(this.entities, entityName => {
      let Model = this.model(entityName);
      return Model.baseClasses && Model.baseClasses.indexOf(baseEntityName) > -1;
    });
  }

  async retry_(transactionName, action_, connOptions, maxRetry, interval, onRetry_) {
    if (connOptions && connOptions.connection) {
      return action_(directReturn, directReturn);
    }

    let i = 0;
    if (maxRetry == null) maxRetry = 2;

    while (i++ < maxRetry) {
      const [finished, result] = await action_(retryOK, retryFailed);

      if (finished) {
        return result;
      }

      if (i === maxRetry) {
        throw result;
      }

      this.app.logException("warn", result, `Unable to complete "${transactionName}" and will try ${maxRetry - i} more times after ${interval || 0} ms.`);

      if (interval != null) {
        await sleep_(interval);
      }

      if (onRetry_) {
        await onRetry_();
      }
    }
  }

  async safeRetry_(transactionName, action_, connOptions, maxRetry, interval, onRetry_) {
    return this.retry_(transactionName, (ok, failed) => this.doTransaction_(async connOpts => ok(await action_(connOpts)), failed, connOptions), connOptions, maxRetry, interval, onRetry_);
  }

  async close_() {
    delete this._modelCache;
    delete this.connector;
    delete this.app;
  }

}

module.exports = DbModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9EYk1vZGVsLmpzIl0sIm5hbWVzIjpbIl8iLCJwYXNjYWxDYXNlIiwic2xlZXBfIiwicmVxdWlyZSIsInJldHJ5RmFpbGVkIiwiZXJyb3IiLCJyZXRyeU9LIiwicmVzdWx0IiwiZGlyZWN0UmV0dXJuIiwiYSIsIkRiTW9kZWwiLCJjb25zdHJ1Y3RvciIsImFwcCIsImNvbm5lY3RvciIsImkxOG4iLCJfbW9kZWxDYWNoZSIsImRyaXZlciIsIm1vZGVsIiwiZW50aXR5TmFtZSIsIm1vZGVsQ2xhc3NOYW1lIiwiZW50aXR5Q3VzdG9tQ2xhc3NGYWN0b3J5IiwibG9hZEN1c3RvbU1vZGVsIiwiZW50aXR5Q2xhc3NGYWN0b3J5IiwibG9hZE1vZGVsIiwiQmFzZUVudGl0eU1vZGVsIiwibW9kZWxDbGFzcyIsImRiIiwiX19pbml0IiwiZW50aXRpZXNPZlR5cGUiLCJiYXNlRW50aXR5TmFtZSIsImZpbHRlciIsImVudGl0aWVzIiwiTW9kZWwiLCJiYXNlQ2xhc3NlcyIsImluZGV4T2YiLCJyZXRyeV8iLCJ0cmFuc2FjdGlvbk5hbWUiLCJhY3Rpb25fIiwiY29ubk9wdGlvbnMiLCJtYXhSZXRyeSIsImludGVydmFsIiwib25SZXRyeV8iLCJjb25uZWN0aW9uIiwiaSIsImZpbmlzaGVkIiwibG9nRXhjZXB0aW9uIiwic2FmZVJldHJ5XyIsIm9rIiwiZmFpbGVkIiwiZG9UcmFuc2FjdGlvbl8iLCJjb25uT3B0cyIsImNsb3NlXyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNO0FBQUVBLEVBQUFBLENBQUY7QUFBS0MsRUFBQUEsVUFBTDtBQUFpQkMsRUFBQUE7QUFBakIsSUFBNEJDLE9BQU8sQ0FBQyxVQUFELENBQXpDOztBQUVBLE1BQU1DLFdBQVcsR0FBSUMsS0FBRCxJQUFXLENBQUMsS0FBRCxFQUFRQSxLQUFSLENBQS9COztBQUNBLE1BQU1DLE9BQU8sR0FBSUMsTUFBRCxJQUFZLENBQUMsSUFBRCxFQUFPQSxNQUFQ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QyxLQUFLSixRQUFWLEVBQW9CO0FBQ2hCLGNBQU1oQyxNQUFOO0FBQ0g7O0FBRUQsV0FBS0ssR0FBTCxDQUFTaUMsWUFBVCxDQUNJLE1BREosRUFFSXRDLE1BRkosRUFHSyx1QkFBc0I2QixlQUFnQixrQkFBaUJHLFFBQVEsR0FBR0ksQ0FBRSxxQkFDakVILFFBQVEsSUFBSSxDQUNmLE1BTEw7O0FBUUEsVUFBSUEsUUFBUSxJQUFJLElBQWhCLEVBQXNCO0FBQ2xCLGNBQU10QyxNQUFNLENBQUNzQyxRQUFELENBQVo7QUFDSDs7QUFFRCxVQUFJQyxRQUFKLEVBQWM7QUFDVixjQUFNQSxRQUFRLEVBQWQ7QUFDSDtBQUNKO0FBQ0o7O0FBV2UsUUFBVkssVUFBVSxDQUFDVixlQUFELEVBQWtCQyxPQUFsQixFQUEyQkMsV0FBM0IsRUFBd0NDLFFBQXhDLEVBQWtEQyxRQUFsRCxFQUE0REMsUUFBNUQsRUFBc0U7QUFDbEYsV0FBTyxLQUFLTixNQUFMLENBQ0hDLGVBREcsRUFFSCxDQUFDVyxFQUFELEVBQUtDLE1BQUwsS0FBZ0IsS0FBS0MsY0FBTCxDQUFvQixNQUFPQyxRQUFQLElBQW9CSCxFQUFFLENBQUMsTUFBTVYsT0FBTyxDQUFDYSxRQUFELENBQWQsQ0FBMUMsRUFBcUVGLE1BQXJFLEVBQTZFVixXQUE3RSxDQUZiLEVBR0hBLFdBSEcsRUFJSEMsUUFKRyxFQUtIQyxRQUxHLEVBTUhDLFFBTkcsQ0FBUDtBQVFIOztBQUVXLFFBQU5VLE1BQU0sR0FBRztBQUNYLFdBQU8sS0FBS3BDLFdBQVo7QUFDQSxXQUFPLEtBQUtGLFNBQVo7QUFDQSxXQUFPLEtBQUtELEdBQVo7QUFDSDs7QUE1SFM7O0FBK0hkd0MsTUFBTSxDQUFDQyxPQUFQLEdBQWlCM0MsT0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IF8sIHBhc2NhbENhc2UsIHNsZWVwXyB9ID0gcmVxdWlyZShcInJrLXV0aWxzXCIpO1xuXG5jb25zdCByZXRyeUZhaWxlZCA9IChlcnJvcikgPT4gW2ZhbHNlLCBlcnJvcl07XG5jb25zdCByZXRyeU9LID0gKHJlc3VsdCkgPT4gW3RydWUsIHJlc3VsdF07XG5cbmNvbnN0IGRpcmVjdFJldHVybiA9IChhKSA9PiBhO1xuXG5jbGFzcyBEYk1vZGVsIHtcbiAgICBjb25zdHJ1Y3RvcihhcHAsIGNvbm5lY3RvciwgaTE4bikge1xuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICAgICAgdGhpcy5jb25uZWN0b3IgPSBjb25uZWN0b3I7XG4gICAgICAgIHRoaXMuaTE4biA9IGkxOG47XG5cbiAgICAgICAgdGhpcy5fbW9kZWxDYWNoZSA9IHt9O1xuICAgIH1cblxuICAgIGdldCBkcml2ZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbm5lY3Rvci5kcml2ZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGVudGl0eSBtb2RlbCBjbGFzcyBieSBlbnRpdHkgbmFtZS5cbiAgICAgKiBAcGFyYW0geyp9IGVudGl0eU5hbWUgXG4gICAgICovXG4gICAgbW9kZWwoZW50aXR5TmFtZSkge1xuICAgICAgICBpZiAodGhpcy5fbW9kZWxDYWNoZVtlbnRpdHlOYW1lXSkgcmV0dXJuIHRoaXMuX21vZGVsQ2FjaGVbZW50aXR5TmFtZV07XG5cbiAgICAgICAgbGV0IG1vZGVsQ2xhc3NOYW1lID0gcGFzY2FsQ2FzZShlbnRpdHlOYW1lKTtcbiAgICAgICAgaWYgKHRoaXMuX21vZGVsQ2FjaGVbbW9kZWxDbGFzc05hbWVdKSByZXR1cm4gdGhpcy5fbW9kZWxDYWNoZVttb2RlbENsYXNzTmFtZV07XG5cbiAgICAgICAgbGV0IGVudGl0eUN1c3RvbUNsYXNzRmFjdG9yeSA9IHRoaXMubG9hZEN1c3RvbU1vZGVsKG1vZGVsQ2xhc3NOYW1lKTtcbiAgICAgICAgbGV0IGVudGl0eUNsYXNzRmFjdG9yeSA9IHRoaXMubG9hZE1vZGVsKG1vZGVsQ2xhc3NOYW1lKTtcblxuICAgICAgICBsZXQgQmFzZUVudGl0eU1vZGVsID0gcmVxdWlyZShgLi9kcml2ZXJzLyR7dGhpcy5kcml2ZXJ9L0VudGl0eU1vZGVsYCk7XG4gICAgICAgIGlmIChlbnRpdHlDdXN0b21DbGFzc0ZhY3RvcnkpIHtcbiAgICAgICAgICAgIEJhc2VFbnRpdHlNb2RlbCA9IGVudGl0eUN1c3RvbUNsYXNzRmFjdG9yeShCYXNlRW50aXR5TW9kZWwpOyAgICAgICAgICAgIFxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbW9kZWxDbGFzcyA9IGVudGl0eUNsYXNzRmFjdG9yeShCYXNlRW50aXR5TW9kZWwpO1xuICAgICAgICBtb2RlbENsYXNzLmRiID0gdGhpcztcblxuICAgICAgICBpZiAobW9kZWxDbGFzcy5fX2luaXQpIHtcbiAgICAgICAgICAgIG1vZGVsQ2xhc3MuX19pbml0KCk7XG4gICAgICAgIH1cbiBcbiAgICAgICAgdGhpcy5fbW9kZWxDYWNoZVtlbnRpdHlOYW1lXSA9IG1vZGVsQ2xhc3M7XG4gICAgICAgIGlmIChtb2RlbENsYXNzTmFtZSAhPT0gZW50aXR5TmFtZSkge1xuICAgICAgICAgICAgdGhpcy5fbW9kZWxDYWNoZVttb2RlbENsYXNzTmFtZV0gPSBtb2RlbENsYXNzO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG1vZGVsQ2xhc3M7XG4gICAgfVxuXG4gICAgZW50aXRpZXNPZlR5cGUoYmFzZUVudGl0eU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIF8uZmlsdGVyKHRoaXMuZW50aXRpZXMsIChlbnRpdHlOYW1lKSA9PiB7XG4gICAgICAgICAgICBsZXQgTW9kZWwgPSB0aGlzLm1vZGVsKGVudGl0eU5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIE1vZGVsLmJhc2VDbGFzc2VzICYmIE1vZGVsLmJhc2VDbGFzc2VzLmluZGV4T2YoYmFzZUVudGl0eU5hbWUpID4gLTE7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJ1biBhbiBhY3Rpb24gYW5kIGF1dG9tYXRpY2FsbHkgcmV0cnkgd2hlbiBmYWlsZWQuIFxuICAgICAqIEBwYXJhbSB7Kn0gdHJhbnNhY3Rpb25OYW1lIFxuICAgICAqIEBwYXJhbSB7Kn0gYWN0aW9uXyBcbiAgICAgKiBAcGFyYW0geyp9IGNvbm5PcHRpb25zIFxuICAgICAqIEBwYXJhbSB7Kn0gbWF4UmV0cnkgXG4gICAgICogQHBhcmFtIHsqfSBpbnRlcnZhbCBcbiAgICAgKiBAcGFyYW0geyp9IG9uUmV0cnlfIFxuICAgICAqL1xuICAgIGFzeW5jIHJldHJ5Xyh0cmFuc2FjdGlvbk5hbWUsIGFjdGlvbl8sIGNvbm5PcHRpb25zLCBtYXhSZXRyeSwgaW50ZXJ2YWwsIG9uUmV0cnlfKSB7XG4gICAgICAgIC8vcmV0cnkgd2lsbCBiZSBpZ25vcmVkLCBpZiB0aGUgdHJhbnNhY3Rpb24gaXMgYSBwYXJ0IG9mIGFub3RoZXIgdHJhbnNhY3Rpb25cbiAgICAgICAgaWYgKGNvbm5PcHRpb25zICYmIGNvbm5PcHRpb25zLmNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgIHJldHVybiBhY3Rpb25fKGRpcmVjdFJldHVybiwgZGlyZWN0UmV0dXJuKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgaWYgKG1heFJldHJ5ID09IG51bGwpIG1heFJldHJ5ID0gMjtcblxuICAgICAgICB3aGlsZSAoaSsrIDwgbWF4UmV0cnkpIHtcbiAgICAgICAgICAgIGNvbnN0IFtmaW5pc2hlZCwgcmVzdWx0XSA9IGF3YWl0IGFjdGlvbl8ocmV0cnlPSywgcmV0cnlGYWlsZWQpO1xuXG4gICAgICAgICAgICBpZiAoZmluaXNoZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaSA9PT0gbWF4UmV0cnkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyByZXN1bHQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuYXBwLmxvZ0V4Y2VwdGlvbihcbiAgICAgICAgICAgICAgICBcIndhcm5cIixcbiAgICAgICAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgICAgICAgYFVuYWJsZSB0byBjb21wbGV0ZSBcIiR7dHJhbnNhY3Rpb25OYW1lfVwiIGFuZCB3aWxsIHRyeSAke21heFJldHJ5IC0gaX0gbW9yZSB0aW1lcyBhZnRlciAke1xuICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbCB8fCAwXG4gICAgICAgICAgICAgICAgfSBtcy5gXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAoaW50ZXJ2YWwgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHNsZWVwXyhpbnRlcnZhbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvblJldHJ5Xykge1xuICAgICAgICAgICAgICAgIGF3YWl0IG9uUmV0cnlfKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSdW4gYW4gYWN0aW9uIGFzIHRyYW5zYWN0aW9uIGFuZCBhdXRvbWF0aWNhbGx5IHJldHJ5IHdoZW4gZmFpbGVkLiBcbiAgICAgKiBAcGFyYW0geyp9IHRyYW5zYWN0aW9uTmFtZSBcbiAgICAgKiBAcGFyYW0geyp9IGFjdGlvbl8gXG4gICAgICogQHBhcmFtIHsqfSBjb25uT3B0aW9ucyBcbiAgICAgKiBAcGFyYW0geyp9IG1heFJldHJ5IFxuICAgICAqIEBwYXJhbSB7Kn0gaW50ZXJ2YWwgXG4gICAgICogQHBhcmFtIHsqfSBvblJldHJ5XyBcbiAgICAgKi9cbiAgICBhc3luYyBzYWZlUmV0cnlfKHRyYW5zYWN0aW9uTmFtZSwgYWN0aW9uXywgY29ubk9wdGlvbnMsIG1heFJldHJ5LCBpbnRlcnZhbCwgb25SZXRyeV8pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmV0cnlfKFxuICAgICAgICAgICAgdHJhbnNhY3Rpb25OYW1lLFxuICAgICAgICAgICAgKG9rLCBmYWlsZWQpID0+IHRoaXMuZG9UcmFuc2FjdGlvbl8oYXN5bmMgKGNvbm5PcHRzKSA9PiBvayhhd2FpdCBhY3Rpb25fKGNvbm5PcHRzKSksIGZhaWxlZCwgY29ubk9wdGlvbnMpLFxuICAgICAgICAgICAgY29ubk9wdGlvbnMsXG4gICAgICAgICAgICBtYXhSZXRyeSxcbiAgICAgICAgICAgIGludGVydmFsLFxuICAgICAgICAgICAgb25SZXRyeV9cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICBhc3luYyBjbG9zZV8oKSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLl9tb2RlbENhY2hlO1xuICAgICAgICBkZWxldGUgdGhpcy5jb25uZWN0b3I7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmFwcDtcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gRGJNb2RlbDtcbiJdfQ==