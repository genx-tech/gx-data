"use strict";

require("source-map-support/register");

const {
  _,
  pascalCase,
  sleep_
} = require("rk-utils");

const retryFailed = error => [false, error];

const retryOK = result => [true, result];

const directReturn = a => a;

class DbModel {
  constructor(app, connector, i18n) {
    this.app = app;
    this.connector = connector;
    this.i18n = i18n;
    this._modelCache = {};
  }

  get driver() {
    return this.connector.driver;
  }

  model(entityName) {
    if (this._modelCache[entityName]) return this._modelCache[entityName];
    let modelClassName = pascalCase(entityName);
    if (this._modelCache[modelClassName]) return this._modelCache[modelClassName];
    let entityCustomClassFactory = this.loadCustomModel(modelClassName);
    let entityClassFactory = this.loadModel(modelClassName);

    let BaseEntityModel = require(`./drivers/${this.driver}/EntityModel`);

    if (entityCustomClassFactory) {
      BaseEntityModel = entityCustomClassFactory(BaseEntityModel);
    }

    const modelClass = entityClassFactory(BaseEntityModel);
    modelClass.db = this;

    if (modelClass.__init) {
      modelClass.__init();
    }

    this._modelCache[entityName] = modelClass;

    if (modelClassName !== entityName) {
      this._modelCache[modelClassName] = modelClass;
    }

    return modelClass;
  }

  entitiesOfType(baseEntityName) {
    return _.filter(this.entities, entityName => {
      let Model = this.model(entityName);
      return Model.baseClasses && Model.baseClasses.indexOf(baseEntityName) > -1;
    });
  }

  async retry_(transactionName, action_, connOptions, maxRetry, interval, onRetry_) {
    if (connOptions && connOptions.connection) {
      return action_(directReturn, directReturn);
    }

    let i = 0;
    if (maxRetry == null) maxRetry = 2;

    while (i++ < maxRetry) {
      const [finished, result] = await action_(retryOK, retryFailed);

      if (finished) {
        return result;
      }

      if (i === maxRetry) {
        throw result;
      }

      this.app.logException("warn", result, `Unable to complete "${transactionName}" and will try ${maxRetry - i} more times after ${interval || 0} ms.`);

      if (interval != null) {
        await sleep_(interval);
      }

      if (onRetry_) {
        await onRetry_();
      }
    }
  }

  async safeRetry_(transactionName, action_, connOptions, maxRetry, interval, onRetry_) {
    return this.retry_(transactionName, (ok, failed) => this.doTransaction_(async connOpts => ok((await action_(connOpts))), failed, connOptions), connOptions, maxRetry, interval, onRetry_);
  }

  async close_() {
    delete this._modelCache;
    delete this.connector;
    delete this.app;
  }

}

module.exports = DbModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9EYk1vZGVsLmpzIl0sIm5hbWVzIjpbIl8iLCJwYXNjYWxDYXNlIiwic2xlZXBfIiwicmVxdWlyZSIsInJldHJ5RmFpbGVkIiwiZXJyb3IiLCJyZXRyeU9LIiwicmVzdWx0IiwiZGlyZWN0UmV0dXJuIiwiYSIsIkRiTW9kZWwiLCJjb25zdHJ1Y3RvciIsImFwcCIsImNvbm5lY3RvciIsImkxOG4iLCJfbW9kZWxDYWNoZSIsImRyaXZlciIsIm1vZGVsIiwiZW50aXR5TmFtZSIsIm1vZGVsQ2xhc3NOYW1lIiwiZW50aXR5Q3VzdG9tQ2xhc3NGYWN0b3J5IiwibG9hZEN1c3RvbU1vZGVsIiwiZW50aXR5Q2xhc3NGYWN0b3J5IiwibG9hZE1vZGVsIiwiQmFzZUVudGl0eU1vZGVsIiwibW9kZWxDbGFzcyIsImRiIiwiX19pbml0IiwiZW50aXRpZXNPZlR5cGUiLCJiYXNlRW50aXR5TmFtZSIsImZpbHRlciIsImVudGl0aWVzIiwiTW9kZWwiLCJiYXNlQ2xhc3NlcyIsImluZGV4T2YiLCJyZXRyeV8iLCJ0cmFuc2FjdGlvbk5hbWUiLCJhY3Rpb25fIiwiY29ubk9wdGlvbnMiLCJtYXhSZXRyeSIsImludGVydmFsIiwib25SZXRyeV8iLCJjb25uZWN0aW9uIiwiaSIsImZpbmlzaGVkIiwibG9nRXhjZXB0aW9uIiwic2FmZVJldHJ5XyIsIm9rIiwiZmFpbGVkIiwiZG9UcmFuc2FjdGlvbl8iLCJjb25uT3B0cyIsImNsb3NlXyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNO0FBQUVBLEVBQUFBLENBQUY7QUFBS0MsRUFBQUEsVUFBTDtBQUFpQkMsRUFBQUE7QUFBakIsSUFBNEJDLE9BQU8sQ0FBQyxVQUFELENBQXpDOztBQUVBLE1BQU1DLFdBQVcsR0FBSUMsS0FBRCxJQUFXLENBQUMsS0FBRCxFQUFRQSxLQUFSLENBQS9COztBQUNBLE1BQU1DLE9BQU8sR0FBSUMsTUFBRCxJQUFZLENBQUMsSUFBRCxFQUFPQSxNQUFQ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QyxLQUFLSixRQUFWLEVBQW9CO0FBQ2hCLGNBQU1oQyxNQUFOO0FBQ0g7O0FBRUQsV0FBS0ssR0FBTCxDQUFTaUMsWUFBVCxDQUNJLE1BREosRUFFSXRDLE1BRkosRUFHSyx1QkFBc0I2QixlQUFnQixrQkFBaUJHLFFBQVEsR0FBR0ksQ0FBRSxxQkFDakVILFFBQVEsSUFBSSxDQUNmLE1BTEw7O0FBUUEsVUFBSUEsUUFBUSxJQUFJLElBQWhCLEVBQXNCO0FBQ2xCLGNBQU10QyxNQUFNLENBQUNzQyxRQUFELENBQVo7QUFDSDs7QUFFRCxVQUFJQyxRQUFKLEVBQWM7QUFDVixjQUFNQSxRQUFRLEVBQWQ7QUFDSDtBQUNKO0FBQ0o7O0FBV0QsUUFBTUssVUFBTixDQUFpQlYsZUFBakIsRUFBa0NDLE9BQWxDLEVBQTJDQyxXQUEzQyxFQUF3REMsUUFBeEQsRUFBa0VDLFFBQWxFLEVBQTRFQyxRQUE1RSxFQUFzRjtBQUNsRixXQUFPLEtBQUtOLE1BQUwsQ0FDSEMsZUFERyxFQUVILENBQUNXLEVBQUQsRUFBS0MsTUFBTCxLQUFnQixLQUFLQyxjQUFMLENBQW9CLE1BQU9DLFFBQVAsSUFBb0JILEVBQUUsRUFBQyxNQUFNVixPQUFPLENBQUNhLFFBQUQsQ0FBZCxFQUExQyxFQUFxRUYsTUFBckUsRUFBNkVWLFdBQTdFLENBRmIsRUFHSEEsV0FIRyxFQUlIQyxRQUpHLEVBS0hDLFFBTEcsRUFNSEMsUUFORyxDQUFQO0FBUUg7O0FBRUQsUUFBTVUsTUFBTixHQUFlO0FBQ1gsV0FBTyxLQUFLcEMsV0FBWjtBQUNBLFdBQU8sS0FBS0YsU0FBWjtBQUNBLFdBQU8sS0FBS0QsR0FBWjtBQUNIOztBQTVIUzs7QUErSGR3QyxNQUFNLENBQUNDLE9BQVAsR0FBaUIzQyxPQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgXywgcGFzY2FsQ2FzZSwgc2xlZXBfIH0gPSByZXF1aXJlKFwicmstdXRpbHNcIik7XG5cbmNvbnN0IHJldHJ5RmFpbGVkID0gKGVycm9yKSA9PiBbZmFsc2UsIGVycm9yXTtcbmNvbnN0IHJldHJ5T0sgPSAocmVzdWx0KSA9PiBbdHJ1ZSwgcmVzdWx0XTtcblxuY29uc3QgZGlyZWN0UmV0dXJuID0gKGEpID0+IGE7XG5cbmNsYXNzIERiTW9kZWwge1xuICAgIGNvbnN0cnVjdG9yKGFwcCwgY29ubmVjdG9yLCBpMThuKSB7XG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xuICAgICAgICB0aGlzLmNvbm5lY3RvciA9IGNvbm5lY3RvcjtcbiAgICAgICAgdGhpcy5pMThuID0gaTE4bjtcblxuICAgICAgICB0aGlzLl9tb2RlbENhY2hlID0ge307XG4gICAgfVxuXG4gICAgZ2V0IGRyaXZlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdG9yLmRyaXZlcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgZW50aXR5IG1vZGVsIGNsYXNzIGJ5IGVudGl0eSBuYW1lLlxuICAgICAqIEBwYXJhbSB7Kn0gZW50aXR5TmFtZSBcbiAgICAgKi9cbiAgICBtb2RlbChlbnRpdHlOYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLl9tb2RlbENhY2hlW2VudGl0eU5hbWVdKSByZXR1cm4gdGhpcy5fbW9kZWxDYWNoZVtlbnRpdHlOYW1lXTtcblxuICAgICAgICBsZXQgbW9kZWxDbGFzc05hbWUgPSBwYXNjYWxDYXNlKGVudGl0eU5hbWUpO1xuICAgICAgICBpZiAodGhpcy5fbW9kZWxDYWNoZVttb2RlbENsYXNzTmFtZV0pIHJldHVybiB0aGlzLl9tb2RlbENhY2hlW21vZGVsQ2xhc3NOYW1lXTtcblxuICAgICAgICBsZXQgZW50aXR5Q3VzdG9tQ2xhc3NGYWN0b3J5ID0gdGhpcy5sb2FkQ3VzdG9tTW9kZWwobW9kZWxDbGFzc05hbWUpO1xuICAgICAgICBsZXQgZW50aXR5Q2xhc3NGYWN0b3J5ID0gdGhpcy5sb2FkTW9kZWwobW9kZWxDbGFzc05hbWUpO1xuXG4gICAgICAgIGxldCBCYXNlRW50aXR5TW9kZWwgPSByZXF1aXJlKGAuL2RyaXZlcnMvJHt0aGlzLmRyaXZlcn0vRW50aXR5TW9kZWxgKTtcbiAgICAgICAgaWYgKGVudGl0eUN1c3RvbUNsYXNzRmFjdG9yeSkge1xuICAgICAgICAgICAgQmFzZUVudGl0eU1vZGVsID0gZW50aXR5Q3VzdG9tQ2xhc3NGYWN0b3J5KEJhc2VFbnRpdHlNb2RlbCk7ICAgICAgICAgICAgXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtb2RlbENsYXNzID0gZW50aXR5Q2xhc3NGYWN0b3J5KEJhc2VFbnRpdHlNb2RlbCk7XG4gICAgICAgIG1vZGVsQ2xhc3MuZGIgPSB0aGlzO1xuXG4gICAgICAgIGlmIChtb2RlbENsYXNzLl9faW5pdCkge1xuICAgICAgICAgICAgbW9kZWxDbGFzcy5fX2luaXQoKTtcbiAgICAgICAgfVxuIFxuICAgICAgICB0aGlzLl9tb2RlbENhY2hlW2VudGl0eU5hbWVdID0gbW9kZWxDbGFzcztcbiAgICAgICAgaWYgKG1vZGVsQ2xhc3NOYW1lICE9PSBlbnRpdHlOYW1lKSB7XG4gICAgICAgICAgICB0aGlzLl9tb2RlbENhY2hlW21vZGVsQ2xhc3NOYW1lXSA9IG1vZGVsQ2xhc3M7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbW9kZWxDbGFzcztcbiAgICB9XG5cbiAgICBlbnRpdGllc09mVHlwZShiYXNlRW50aXR5TmFtZSkge1xuICAgICAgICByZXR1cm4gXy5maWx0ZXIodGhpcy5lbnRpdGllcywgKGVudGl0eU5hbWUpID0+IHtcbiAgICAgICAgICAgIGxldCBNb2RlbCA9IHRoaXMubW9kZWwoZW50aXR5TmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gTW9kZWwuYmFzZUNsYXNzZXMgJiYgTW9kZWwuYmFzZUNsYXNzZXMuaW5kZXhPZihiYXNlRW50aXR5TmFtZSkgPiAtMTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUnVuIGFuIGFjdGlvbiBhbmQgYXV0b21hdGljYWxseSByZXRyeSB3aGVuIGZhaWxlZC4gXG4gICAgICogQHBhcmFtIHsqfSB0cmFuc2FjdGlvbk5hbWUgXG4gICAgICogQHBhcmFtIHsqfSBhY3Rpb25fIFxuICAgICAqIEBwYXJhbSB7Kn0gY29ubk9wdGlvbnMgXG4gICAgICogQHBhcmFtIHsqfSBtYXhSZXRyeSBcbiAgICAgKiBAcGFyYW0geyp9IGludGVydmFsIFxuICAgICAqIEBwYXJhbSB7Kn0gb25SZXRyeV8gXG4gICAgICovXG4gICAgYXN5bmMgcmV0cnlfKHRyYW5zYWN0aW9uTmFtZSwgYWN0aW9uXywgY29ubk9wdGlvbnMsIG1heFJldHJ5LCBpbnRlcnZhbCwgb25SZXRyeV8pIHtcbiAgICAgICAgLy9yZXRyeSB3aWxsIGJlIGlnbm9yZWQsIGlmIHRoZSB0cmFuc2FjdGlvbiBpcyBhIHBhcnQgb2YgYW5vdGhlciB0cmFuc2FjdGlvblxuICAgICAgICBpZiAoY29ubk9wdGlvbnMgJiYgY29ubk9wdGlvbnMuY29ubmVjdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuIGFjdGlvbl8oZGlyZWN0UmV0dXJuLCBkaXJlY3RSZXR1cm4pO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICBpZiAobWF4UmV0cnkgPT0gbnVsbCkgbWF4UmV0cnkgPSAyO1xuXG4gICAgICAgIHdoaWxlIChpKysgPCBtYXhSZXRyeSkge1xuICAgICAgICAgICAgY29uc3QgW2ZpbmlzaGVkLCByZXN1bHRdID0gYXdhaXQgYWN0aW9uXyhyZXRyeU9LLCByZXRyeUZhaWxlZCk7XG5cbiAgICAgICAgICAgIGlmIChmaW5pc2hlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpID09PSBtYXhSZXRyeSkge1xuICAgICAgICAgICAgICAgIHRocm93IHJlc3VsdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5hcHAubG9nRXhjZXB0aW9uKFxuICAgICAgICAgICAgICAgIFwid2FyblwiLFxuICAgICAgICAgICAgICAgIHJlc3VsdCxcbiAgICAgICAgICAgICAgICBgVW5hYmxlIHRvIGNvbXBsZXRlIFwiJHt0cmFuc2FjdGlvbk5hbWV9XCIgYW5kIHdpbGwgdHJ5ICR7bWF4UmV0cnkgLSBpfSBtb3JlIHRpbWVzIGFmdGVyICR7XG4gICAgICAgICAgICAgICAgICAgIGludGVydmFsIHx8IDBcbiAgICAgICAgICAgICAgICB9IG1zLmBcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChpbnRlcnZhbCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgc2xlZXBfKGludGVydmFsKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG9uUmV0cnlfKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgb25SZXRyeV8oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJ1biBhbiBhY3Rpb24gYXMgdHJhbnNhY3Rpb24gYW5kIGF1dG9tYXRpY2FsbHkgcmV0cnkgd2hlbiBmYWlsZWQuIFxuICAgICAqIEBwYXJhbSB7Kn0gdHJhbnNhY3Rpb25OYW1lIFxuICAgICAqIEBwYXJhbSB7Kn0gYWN0aW9uXyBcbiAgICAgKiBAcGFyYW0geyp9IGNvbm5PcHRpb25zIFxuICAgICAqIEBwYXJhbSB7Kn0gbWF4UmV0cnkgXG4gICAgICogQHBhcmFtIHsqfSBpbnRlcnZhbCBcbiAgICAgKiBAcGFyYW0geyp9IG9uUmV0cnlfIFxuICAgICAqL1xuICAgIGFzeW5jIHNhZmVSZXRyeV8odHJhbnNhY3Rpb25OYW1lLCBhY3Rpb25fLCBjb25uT3B0aW9ucywgbWF4UmV0cnksIGludGVydmFsLCBvblJldHJ5Xykge1xuICAgICAgICByZXR1cm4gdGhpcy5yZXRyeV8oXG4gICAgICAgICAgICB0cmFuc2FjdGlvbk5hbWUsXG4gICAgICAgICAgICAob2ssIGZhaWxlZCkgPT4gdGhpcy5kb1RyYW5zYWN0aW9uXyhhc3luYyAoY29ubk9wdHMpID0+IG9rKGF3YWl0IGFjdGlvbl8oY29ubk9wdHMpKSwgZmFpbGVkLCBjb25uT3B0aW9ucyksXG4gICAgICAgICAgICBjb25uT3B0aW9ucyxcbiAgICAgICAgICAgIG1heFJldHJ5LFxuICAgICAgICAgICAgaW50ZXJ2YWwsXG4gICAgICAgICAgICBvblJldHJ5X1xuICAgICAgICApO1xuICAgIH1cblxuICAgIGFzeW5jIGNsb3NlXygpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuX21vZGVsQ2FjaGU7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmNvbm5lY3RvcjtcbiAgICAgICAgZGVsZXRlIHRoaXMuYXBwO1xuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBEYk1vZGVsO1xuIl19